build-android.bat

@echo off
echo ===============================================
echo Ball Sort Puzzle - Android Build Script
echo ===============================================

echo.
echo Step 1: Creating Cordova project...
cd C:\Users\mayank_aggarwal2\
if exist BallSortPuzzleApp rmdir /s /q BallSortPuzzleApp
cordova create BallSortPuzzleApp com.yourcompany.ballsortpuzzle "Ball Sort Puzzle"
cd BallSortPuzzleApp

echo.
echo Step 2: Adding Android platform...
cordova platform add android

echo.
echo Step 3: Installing required plugins...
cordova plugin add cordova-plugin-admob-free --variable ADMOB_ANDROID_APP_ID="ca-app-pub-3940256099942544~3347511713" --variable ADMOB_IOS_APP_ID="ca-app-pub-3940256099942544~1458002511"
cordova plugin add cordova-plugin-device
cordova plugin add cordova-plugin-network-information
cordova plugin add cordova-plugin-vibration
cordova plugin add cordova-plugin-statusbar
cordova plugin add cordova-plugin-splashscreen
cordova plugin add cordova-plugin-whitelist

echo.
echo Step 4: Copying game files...
cd www
del index.html
del css\index.css
del js\index.js
rmdir /s /q css
rmdir /s /q js
rmdir /s /q img

copy "C:\Users\mayank_aggarwal2\ball_sort_game\index-mobile.html" index.html
copy "C:\Users\mayank_aggarwal2\ball_sort_game\game.js" .
copy "C:\Users\mayank_aggarwal2\ball_sort_game\user-progress.js" .
copy "C:\Users\mayank_aggarwal2\ball_sort_game\styles.css" .

cd ..

echo.
echo Step 5: Copying configuration...
copy "C:\Users\mayank_aggarwal2\ball_sort_game\config.xml" .

echo.
echo Step 6: Building APK...
cordova build android

echo.
echo ===============================================
echo Build Complete!
echo ===============================================
echo.
echo APK Location: platforms\android\app\build\outputs\apk\debug\app-debug.apk
echo.
echo To install on device:
echo 1. Enable USB Debugging on your Android device
echo 2. Connect device via USB
echo 3. Run: cordova run android --device
echo.
echo To test on emulator:
echo 1. Open Android Studio and create an AVD
echo 2. Run: cordova emulate android
echo.
echo For release build:
echo 1. Run: cordova build android --release
echo 2. Sign the APK for Play Store submission
echo.

pause


build-android.md

# Android Build Instructions for Ball Sort Puzzle

## File Structure After Cordova Setup

```
BallSortPuzzleApp/
â”œâ”€â”€ www/                    # Your web app files go here
â”‚   â”œâ”€â”€ index.html         # Copy your game files here
â”‚   â”œâ”€â”€ game.js
â”‚   â”œâ”€â”€ user-progress.js
â”‚   â”œâ”€â”€ styles.css
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ img/
â”œâ”€â”€ platforms/
â”‚   â””â”€â”€ android/           # Generated Android project
â”œâ”€â”€ plugins/               # Cordova plugins
â”œâ”€â”€ config.xml            # App configuration
â””â”€â”€ package.json
```

## Step-by-Step File Copy Process

1. **Navigate to your Cordova project www folder:**
   ```bash
   cd C:\Users\mayank_aggarwal2\BallSortPuzzleApp\www
   ```

2. **Delete default files and copy your game:**
   ```bash
   # Remove default Cordova files
   del index.html css\index.css js\index.js

   # Copy your game files
   copy "C:\Users\mayank_aggarwal2\ball_sort_game\index.html" .
   copy "C:\Users\mayank_aggarwal2\ball_sort_game\game.js" .
   copy "C:\Users\mayank_aggarwal2\ball_sort_game\user-progress.js" .
   copy "C:\Users\mayank_aggarwal2\ball_sort_game\styles.css" .
   ```

## Required Modifications for Mobile

Your game already has AdMob integration prepared, but you'll need to make these adjustments:

### 1. Update index.html for Cordova

Add these meta tags and Cordova script:
```html
<meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;">
<meta name="format-detection" content="telephone=no">
<meta name="msapplication-tap-highlight" content="no">
<meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">

<!-- Cordova Script - MUST be included -->
<script type="text/javascript" src="cordova.js"></script>
```

### 2. Install Required Plugins

```bash
# AdMob plugin for ads
cordova plugin add cordova-plugin-admob-free

# Device information
cordova plugin add cordova-plugin-device

# Network information
cordova plugin add cordova-plugin-network-information

# Vibration for haptic feedback
cordova plugin add cordova-plugin-vibration

# Status bar control
cordova plugin add cordova-plugin-statusbar

# Splash screen
cordova plugin add cordova-plugin-splashscreen

# Whitelist for security
cordova plugin add cordova-plugin-whitelist
```

### 3. Update config.xml

Key configurations for your app:
```xml
<widget id="com.yourcompany.ballsortpuzzle" version="1.0.0">
    <name>Ball Sort Puzzle</name>
    <description>
        Sort colored balls into tubes! Challenge your mind with this addictive puzzle game.
    </description>
    <author email="your-email@example.com" href="http://yourwebsite.com">
        Your Name
    </author>
    
    <!-- Platform specific settings -->
    <platform name="android">
        <preference name="MinSdkVersion" value="22" />
        <preference name="targetSdkVersion" value="33" />
    </platform>
    
    <!-- App permissions -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    
    <!-- AdMob Configuration -->
    <preference name="ADMOB_ANDROID_APP_ID" value="ca-app-pub-3940256099942544~3347511713" />
</widget>
```

## Build Commands

### Development Build
```bash
# Build for Android
cordova build android

# Build and run on connected device
cordova run android

# Build and run on emulator
cordova emulate android
```

### Production Build
```bash
# Build release version
cordova build android --release

# Sign the APK (required for Play Store)
# First generate keystore
keytool -genkey -v -keystore ball-sort-puzzle.keystore -alias ball-sort-puzzle -keyalg RSA -keysize 2048 -validity 10000

# Sign the APK
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore ball-sort-puzzle.keystore platforms/android/app/build/outputs/apk/release/app-release-unsigned.apk ball-sort-puzzle

# Align the APK
zipalign -v 4 platforms/android/app/build/outputs/apk/release/app-release-unsigned.apk BallSortPuzzle.apk
```

## Testing Process

1. **Enable Developer Options on Android Device:**
   - Go to Settings > About Phone
   - Tap "Build Number" 7 times
   - Go back to Settings > Developer Options
   - Enable "USB Debugging"

2. **Connect Device and Test:**
   ```bash
   # Check connected devices
   adb devices

   # Install and run
   cordova run android --device
   ```

3. **Test on Emulator:**
   ```bash
   # Create AVD in Android Studio
   # Run emulator
   cordova emulate android
   ```

## Common Issues and Solutions

### Issue 1: Gradle Build Fails
```bash
# Solution: Update Gradle in platforms/android/gradle/wrapper/gradle-wrapper.properties
distributionUrl=https\://services.gradle.org/distributions/gradle-7.4-all.zip
```

### Issue 2: AdMob Not Working
- Ensure you have the correct App ID in config.xml
- Test with provided test IDs first
- Check network permissions

### Issue 3: Performance Issues
- Enable hardware acceleration
- Optimize image sizes
- Use CSS transforms instead of position changes

## Next Steps

1. Copy your files using the commands above
2. Install required plugins
3. Modify config.xml with your app details
4. Build and test on device/emulator
5. Generate signed APK for Play Store submission


config.xml

<?xml version='1.0' encoding='utf-8'?>
<widget id="com.yourcompany.ballsortpuzzle" version="1.0.0" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">
    <name>Ball Sort Puzzle</name>
    <description>
        Sort colored balls into tubes! Challenge your mind with this addictive puzzle game featuring progressive difficulty, smooth animations, and rewarding gameplay.
    </description>
    <author email="your-email@example.com" href="http://yourwebsite.com">
        Your Name
    </author>
    <content src="index.html" />
    
    <!-- Global Preferences -->
    <preference name="DisallowOverscroll" value="true" />
    <preference name="android-minSdkVersion" value="22" />
    <preference name="android-targetSdkVersion" value="33" />
    <preference name="BackgroundColor" value="0xff6B46C1" />
    <preference name="HideKeyboardFormAccessoryBar" value="true" />
    <preference name="Orientation" value="portrait" />
    <preference name="Fullscreen" value="false" />
    
    <!-- AdMob Configuration -->
    <preference name="ADMOB_ANDROID_APP_ID" value="ca-app-pub-3940256099942544~3347511713" />
    <preference name="ADMOB_IOS_APP_ID" value="ca-app-pub-3940256099942544~1458002511" />
    
    <!-- Splash Screen -->
    <preference name="SplashScreen" value="screen" />
    <preference name="SplashScreenDelay" value="3000" />
    <preference name="AutoHideSplashScreen" value="true" />
    <preference name="SplashShowOnlyFirstTime" value="false" />
    <preference name="FadeSplashScreen" value="true" />
    <preference name="SplashScreenBackgroundColor" value="0xff6B46C1" />
    
    <!-- Platform-specific settings -->
    <platform name="android">
        <allow-intent href="market:*" />
        
        <!-- App Icons -->
        <icon density="ldpi" src="www/res/icon/android/drawable-ldpi-icon.png" />
        <icon density="mdpi" src="www/res/icon/android/drawable-mdpi-icon.png" />
        <icon density="hdpi" src="www/res/icon/android/drawable-hdpi-icon.png" />
        <icon density="xhdpi" src="www/res/icon/android/drawable-xhdpi-icon.png" />
        <icon density="xxhdpi" src="www/res/icon/android/drawable-xxhdpi-icon.png" />
        <icon density="xxxhdpi" src="www/res/icon/android/drawable-xxxhdpi-icon.png" />
        
        <!-- Splash Screens -->
        <splash density="land-ldpi" src="www/res/screen/android/drawable-land-ldpi-screen.png" />
        <splash density="land-mdpi" src="www/res/screen/android/drawable-land-mdpi-screen.png" />
        <splash density="land-hdpi" src="www/res/screen/android/drawable-land-hdpi-screen.png" />
        <splash density="land-xhdpi" src="www/res/screen/android/drawable-land-xhdpi-screen.png" />
        <splash density="land-xxhdpi" src="www/res/screen/android/drawable-land-xxhdpi-screen.png" />
        <splash density="land-xxxhdpi" src="www/res/screen/android/drawable-land-xxxhdpi-screen.png" />
        <splash density="port-ldpi" src="www/res/screen/android/drawable-port-ldpi-screen.png" />
        <splash density="port-mdpi" src="www/res/screen/android/drawable-port-mdpi-screen.png" />
        <splash density="port-hdpi" src="www/res/screen/android/drawable-port-hdpi-screen.png" />
        <splash density="port-xhdpi" src="www/res/screen/android/drawable-port-xhdpi-screen.png" />
        <splash density="port-xxhdpi" src="www/res/screen/android/drawable-port-xxhdpi-screen.png" />
        <splash density="port-xxxhdpi" src="www/res/screen/android/drawable-port-xxxhdpi-screen.png" />
        
        <!-- Android specific preferences -->
        <preference name="android-installLocation" value="auto" />
        <preference name="android-windowSoftInputMode" value="adjustResize" />
        <preference name="AndroidPersistentFileLocation" value="Compatibility" />
        <preference name="loadUrlTimeoutValue" value="700000" />
        <preference name="SplashMaintainAspectRatio" value="true" />
        <preference name="SplashShowOnlyFirstTime" value="false" />
    </platform>
    
    <!-- Universal Links and Deep Linking -->
    <allow-intent href="http://*/*" />
    <allow-intent href="https://*/*" />
    <allow-intent href="tel:*" />
    <allow-intent href="sms:*" />
    <allow-intent href="mailto:*" />
    <allow-intent href="geo:*" />
    
    <!-- Content Security Policy -->
    <access origin="*" />
    <access origin="https://ssl.gstatic.com" />
    <access origin="https://googleads.g.doubleclick.net" />
    <access origin="https://pagead2.googlesyndication.com" />
    <access origin="https://cdn.tailwindcss.com" />
    
    <!-- Required for AdMob -->
    <access origin="https://googleads.g.doubleclick.net" />
    <access origin="https://pagead2.googlesyndication.com" />
    <access origin="https://googleads.g.doubleclick.net/*" />
    <access origin="https://pagead2.googlesyndication.com/*" />
    
    <!-- Plugins -->
    <plugin name="cordova-plugin-whitelist" spec="^1.3.5" />
    <plugin name="cordova-plugin-statusbar" spec="^2.4.2" />
    <plugin name="cordova-plugin-device" spec="^2.0.3" />
    <plugin name="cordova-plugin-splashscreen" spec="^6.0.0" />
    <plugin name="cordova-plugin-network-information" spec="^3.0.0" />
    <plugin name="cordova-plugin-vibration" spec="^3.1.1" />
    <plugin name="cordova-plugin-admob-free" spec="^0.27.0">
        <variable name="ADMOB_ANDROID_APP_ID" value="ca-app-pub-3940256099942544~3347511713" />
        <variable name="ADMOB_IOS_APP_ID" value="ca-app-pub-3940256099942544~1458002511" />
    </plugin>
</widget>


cordova-config.xml

<?xml version='1.0' encoding='utf-8'?>
<widget id="com.yourcompany.ballsort" version="1.0.0" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">
    <name>Ball Sort Puzzle</name>
    <description>
        A fun and challenging ball sorting puzzle game with progressive difficulty levels.
    </description>
    <author email="your-email@example.com" href="https://yourwebsite.com">
        Your Name
    </author>
    <content src="index.html" />
    <access origin="*" />
    <allow-intent href="http://*/*" />
    <allow-intent href="https://*/*" />
    <allow-intent href="tel:*" />
    <allow-intent href="sms:*" />
    <allow-intent href="mailto:*" />
    <allow-intent href="geo:*" />
    
    <!-- Android Configuration -->
    <platform name="android">
        <allow-intent href="market:*" />
        <!-- App Icon -->
        <icon density="ldpi" src="res/icon/android/drawable-ldpi-icon.png" />
        <icon density="mdpi" src="res/icon/android/drawable-mdpi-icon.png" />
        <icon density="hdpi" src="res/icon/android/drawable-hdpi-icon.png" />
        <icon density="xhdpi" src="res/icon/android/drawable-xhdpi-icon.png" />
        <icon density="xxhdpi" src="res/icon/android/drawable-xxhdpi-icon.png" />
        <icon density="xxxhdpi" src="res/icon/android/drawable-xxxhdpi-icon.png" />
        
        <!-- Splash Screen -->
        <splash density="land-ldpi" src="res/screen/android/drawable-land-ldpi-screen.png" />
        <splash density="land-mdpi" src="res/screen/android/drawable-land-mdpi-screen.png" />
        <splash density="land-hdpi" src="res/screen/android/drawable-land-hdpi-screen.png" />
        <splash density="land-xhdpi" src="res/screen/android/drawable-land-xhdpi-screen.png" />
        <splash density="land-xxhdpi" src="res/screen/android/drawable-land-xxhdpi-screen.png" />
        <splash density="land-xxxhdpi" src="res/screen/android/drawable-land-xxxhdpi-screen.png" />
        <splash density="port-ldpi" src="res/screen/android/drawable-port-ldpi-screen.png" />
        <splash density="port-mdpi" src="res/screen/android/drawable-port-mdpi-screen.png" />
        <splash density="port-hdpi" src="res/screen/android/drawable-port-hdpi-screen.png" />
        <splash density="port-xhdpi" src="res/screen/android/drawable-port-xhdpi-screen.png" />
        <splash density="port-xxhdpi" src="res/screen/android/drawable-port-xxhdpi-screen.png" />
        <splash density="port-xxxhdpi" src="res/screen/android/drawable-port-xxxhdpi-screen.png" />
        
        <!-- Permissions -->
        <uses-permission android:name="android.permission.INTERNET" />
        <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
        <uses-permission android:name="android.permission.VIBRATE" />
    </platform>
    
    <!-- Preferences -->
    <preference name="DisallowOverscroll" value="true" />
    <preference name="android-minSdkVersion" value="22" />
    <preference name="android-targetSdkVersion" value="33" />
    <preference name="BackupWebStorage" value="none" />
    <preference name="SplashMaintainAspectRatio" value="true" />
    <preference name="FadeSplashScreenDuration" value="300" />
    <preference name="SplashShowOnlyFirstTime" value="false" />
    <preference name="SplashScreen" value="screen" />
    <preference name="SplashScreenDelay" value="3000" />
    <preference name="Orientation" value="portrait" />
    
    <!-- AdMob Configuration -->
    <preference name="ADMOB_APP_ID" value="ca-app-pub-3940256099942544~3347511713" />
</widget>


game.js

/**
 * Ball Sort Puzzle Game
 * A complete 2D puzzle game where players sort colored balls into tubes
 * Features: Progressive difficulty, smooth animations, sound effects, hint system
 */

class BallSortGame {
    constructor() {
        // Canvas and rendering
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.canvas.width = 800;
        this.canvas.height = 600;
        
        // Game state
        this.currentLevel = 1;
        this.maxLevel = 50;
        this.maxLevelReached = 1; // Track highest level reached
        this.moves = 0;
        this.gameState = 'playing'; // 'playing', 'paused', 'completed', 'timeup'
        this.isPaused = false;
        
        // User Progress Manager
        this.progressManager = new UserProgressManager();
        this.levelStartTime = Date.now();
        
        // Timer system
        this.timeLeft = 0; // seconds
        this.timerId = null;
        this.levelTimeLimit = 0; // seconds for current level
        
        // Tubes and balls
        this.tubes = [];
        this.selectedTube = -1;
        this.animatingBall = null;
        this.animationProgress = 0;
        
        // Game configuration
        this.tubeWidth = 60;
        this.tubeHeight = 200;
        this.ballSize = 25;
        this.ballSpacing = 5;
        this.maxBallsPerTube = 6;
        
        // Colors for balls
        this.ballColors = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', 
            '#FECA57', '#FF9FF3', '#54A0FF', '#5F27CD',
            '#00D2D3', '#FF9F43', '#A3CB38', '#6C5CE7',
            '#FDA7DF', '#26DE81', '#FD79A8', '#E17055'
        ];
        
        // Game mechanics
        this.moveHistory = [];
        this.hintsUsed = 0;
        this.shufflesUsed = 0;
        this.maxHints = 3;
        this.maxShuffles = 2;
        
        // Animation and effects
        this.particles = [];
        this.shakeEffects = [];
        
        // Audio
        this.soundEnabled = true;
        this.audioInitialized = false;
        this.createAudioElements();
        
        // AdMob integration
        this.admobInitialized = false;
        this.rewardedAd = null;
        this.bannerAd = null;
        this.bannerAdLoaded = false;
        this.initializeAdMob();

        // User Progress Management
        this.progressManager = null;
        this.initializeProgressManager();

        // Show welcome screen first instead of auto-starting
        this.showWelcomeScreen();
        
        // Initialize game but don't start yet
        this.setupEventListeners();
        this.gameLoop();
    }
    
    /**
     * Show welcome screen with start game button
     */
    showWelcomeScreen() {
        const welcomeScreen = document.getElementById('welcomeScreen');
        const gameContainer = document.getElementById('gameContainer');
        const startGameBtn = document.getElementById('startGameBtn');
        
        if (welcomeScreen && gameContainer && startGameBtn) {
            // Ensure welcome screen is visible
            welcomeScreen.classList.remove('fade-out');
            gameContainer.classList.remove('fade-in');
            
            // Add click handler for start button
            startGameBtn.addEventListener('click', () => {
                this.hideWelcomeScreen();
                this.startGame();
            });
            
            console.log('Welcome screen initialized');
        }
    }
    
    /**
     * Hide welcome screen and show game
     */
    hideWelcomeScreen() {
        const welcomeScreen = document.getElementById('welcomeScreen');
        const gameContainer = document.getElementById('gameContainer');
        
        if (welcomeScreen && gameContainer) {
            // Show game container first
            gameContainer.style.display = 'block';
            
            // Fade out welcome screen
            welcomeScreen.classList.add('fade-out');
            
            // Fade in game container after a delay
            setTimeout(() => {
                gameContainer.classList.add('fade-in');
                
                // Hide welcome screen completely after transition
                setTimeout(() => {
                    welcomeScreen.style.display = 'none';
                }, 800);
            }, 300);
            
            console.log('Welcome screen hidden, game started');
        }
    }
    
    /**
     * Start the actual game after welcome screen
     */
    startGame() {
        // Load game state or initialize new game
        this.loadGameState();
        
        // If no saved game, initialize with level 1
        if (this.tubes.length === 0) {
            this.initializeGame();
        }
        
        console.log('Game started successfully');
    }
    
    /**
     * Initialize the game with level 1
     */
    initializeGame() {
        this.generateLevel(this.currentLevel);
        this.updateUI();
        this.saveGameState();
    }
    
    /**
     * Initialize User Progress Management
     */
    async initializeProgressManager() {
        if (typeof UserProgressManager !== 'undefined') {
            this.progressManager = new UserProgressManager();
            await this.progressManager.initialize();
            
            // Load user's max level reached
            const userData = this.progressManager.getUserData();
            if (userData.maxLevelReached > this.currentLevel) {
                this.currentLevel = userData.maxLevelReached;
                console.log(`Restored user to max level: ${this.currentLevel}`);
            }
        } else {
            console.warn('UserProgressManager not available');
        }
    }

    /**
     * Initialize Google AdMob
     */
    initializeAdMob() {
        // Check if AdMob is available (for mobile apps)
        if (typeof window.AdMob !== 'undefined') {
            this.admobInitialized = true;
            this.setupAdMobOptions();
            this.loadBannerAd();
            this.loadRewardedAd();
        } else {
            console.log('AdMob not available - running in web browser');
            // For web testing, we'll simulate ad behavior
            this.admobInitialized = false;
            this.simulateBannerAd();
        }
    }

    /**
     * Setup AdMob options and configuration
     */
    setupAdMobOptions() {
        if (!this.admobInitialized) return;
        
        window.AdMob.setOptions({
            publisherId: "ca-app-pub-YOUR_ACTUAL_PUBLISHER_ID", // Replace with your ID
            bannerAdId: "ca-app-pub-3940256099942544/6300978111", // Test banner ID
            interstitialAdId: "ca-app-pub-3940256099942544/1033173712", // Test interstitial ID
            rewardVideoId: "ca-app-pub-3940256099942544/5224354917", // Test rewarded ID
            isTesting: true, // Set to false for production
            autoShowBanner: false,
            autoShowInterstitial: false,
            autoShowRewarded: false,
            bannerAtTop: false, // Show banner at bottom
            overlap: false, // Don't overlap content
            offsetTopBar: false
        });
    }

    /**
     * Load and show banner ad
     */
    loadBannerAd() {
        if (!this.admobInitialized) return;
        
        try {
            window.AdMob.createBanner({
                adId: 'ca-app-pub-3940256099942544/6300978111', // Test banner ID
                position: window.AdMob.AD_POSITION.BOTTOM_CENTER,
                autoShow: true
            }, () => {
                console.log('Banner ad loaded successfully');
                this.bannerAdLoaded = true;
                this.hideBannerPlaceholder();
            }, (error) => {
                console.error('Failed to load banner ad:', error);
                this.showBannerPlaceholder();
            });
        } catch (error) {
            console.error('Banner ad error:', error);
            this.showBannerPlaceholder();
        }
    }

    /**
     * Hide banner ad
     */
    hideBannerAd() {
        if (this.admobInitialized && this.bannerAdLoaded) {
            try {
                window.AdMob.hideBanner();
                console.log('Banner ad hidden');
            } catch (error) {
                console.error('Error hiding banner:', error);
            }
        }
    }

    /**
     * Show banner ad
     */
    showBannerAd() {
        if (this.admobInitialized && this.bannerAdLoaded) {
            try {
                window.AdMob.showBanner();
                console.log('Banner ad shown');
            } catch (error) {
                console.error('Error showing banner:', error);
            }
        }
    }

    /**
     * Remove banner ad completely
     */
    removeBannerAd() {
        if (this.admobInitialized) {
            try {
                window.AdMob.removeBanner();
                this.bannerAdLoaded = false;
                console.log('Banner ad removed');
            } catch (error) {
                console.error('Error removing banner:', error);
            }
        }
    }

    /**
     * Simulate banner ad for web testing
     */
    simulateBannerAd() {
        const placeholder = document.getElementById('bannerAdPlaceholder');
        if (placeholder) {
            // Simulate different ad types
            const adTypes = [
                { text: 'ðŸŽ® New Mobile Games - Download Now!', color: 'from-blue-500 to-purple-600' },
                { text: 'ðŸ† Best Puzzle Games 2025 - Play Free!', color: 'from-green-500 to-blue-600' },
                { text: 'ðŸŽ¯ Challenge Your Brain - More Puzzles!', color: 'from-purple-500 to-pink-600' },
                { text: 'â­ Rate this game 5 stars!', color: 'from-yellow-500 to-orange-600' }
            ];
            
            let currentAdIndex = 0;
            
            const updateAd = () => {
                const ad = adTypes[currentAdIndex];
                placeholder.textContent = ad.text;
                placeholder.className = `bg-gradient-to-r ${ad.color} text-white text-center py-3 px-6 text-sm cursor-pointer transition-all duration-300 hover:scale-105`;
                currentAdIndex = (currentAdIndex + 1) % adTypes.length;
            };
            
            // Initial ad
            updateAd();
            
            // Rotate ads every 30 seconds
            setInterval(updateAd, 30000);
            
            // Add click handler for demo
            placeholder.addEventListener('click', () => {
                this.showAdClickedNotification();
            });
        }
    }

    /**
     * Show/hide banner placeholder
     */
    showBannerPlaceholder() {
        const container = document.getElementById('bannerAdContainer');
        if (container) {
            container.style.display = 'flex';
        }
    }

    hideBannerPlaceholder() {
        const placeholder = document.getElementById('bannerAdPlaceholder');
        if (placeholder) {
            placeholder.style.display = 'none';
        }
    }

    /**
     * Show ad clicked notification (for demo)
     */
    showAdClickedNotification() {
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 left-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform -translate-x-full transition-transform duration-300';
        notification.innerHTML = `
            <div class="flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="font-bold">Ad clicked! (Demo)</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.classList.remove('-translate-x-full');
        }, 100);
        
        // Remove after 3 seconds
        setTimeout(() => {
            notification.classList.add('-translate-x-full');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    /**
     * Load rewarded ad
     */
    loadRewardedAd() {
        if (!this.admobInitialized) return;
        
        try {
            // Use the rewarded video ad unit ID from options
            window.AdMob.prepareRewardVideoAd({
                adId: 'ca-app-pub-3940256099942544/5224354917', // Test rewarded ID
                autoShow: false
            }, () => {
                console.log('Rewarded ad loaded successfully');
                this.rewardedAd = true;
            }, (error) => {
                console.error('Failed to load rewarded ad:', error);
                this.rewardedAd = false;
            });
        } catch (error) {
            console.error('AdMob rewarded ad error:', error);
        }
    }

    /**
     * Show rewarded ad
     */
    showRewardedAd() {
        if (!this.admobInitialized || !this.rewardedAd) {
            // Fallback for web browser or when ad is not available
            this.simulateRewardedAd();
            return;
        }

        try {
            window.AdMob.showRewardVideoAd(
                () => {
                    console.log('Rewarded ad shown successfully');
                },
                () => {
                    // User watched the ad and earned reward
                    console.log('User earned reward');
                    this.onAdRewardEarned();
                    this.loadRewardedAd(); // Load next ad
                },
                (error) => {
                    console.error('Failed to show rewarded ad:', error);
                    this.onAdFailed();
                }
            );
        } catch (error) {
            console.error('AdMob show error:', error);
            this.onAdFailed();
        }
    }

    /**
     * Simulate rewarded ad for web testing
     */
    simulateRewardedAd() {
        // Show a mock ad interface
        const adOverlay = document.createElement('div');
        adOverlay.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
        adOverlay.innerHTML = `
            <div class="bg-white p-8 rounded-lg text-center max-w-sm mx-4">
                <h3 class="text-xl font-bold mb-4">Watch Ad for Extra Time</h3>
                <p class="mb-6 text-gray-600">Watch a 30-second ad to get +30 seconds</p>
                <div class="mb-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full ad-progress" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Ad simulation: <span id="adTimer">30</span>s</p>
                </div>
                <button id="skipAd" class="bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2" disabled>
                    Skip (15s)
                </button>
                <button id="closeAd" class="bg-red-500 text-white px-4 py-2 rounded" onclick="this.closest('.fixed').remove()">
                    Close
                </button>
            </div>
        `;
        
        document.body.appendChild(adOverlay);
        
        // Simulate ad timer
        let timeLeft = 30;
        const timer = setInterval(() => {
            timeLeft--;
            const timerEl = document.getElementById('adTimer');
            const progressEl = document.querySelector('.ad-progress');
            const skipBtn = document.getElementById('skipAd');
            
            if (timerEl) timerEl.textContent = timeLeft;
            if (progressEl) progressEl.style.width = ((30 - timeLeft) / 30 * 100) + '%';
            
            if (timeLeft <= 15 && skipBtn) {
                skipBtn.disabled = false;
                skipBtn.textContent = 'Skip';
                skipBtn.onclick = () => {
                    clearInterval(timer);
                    adOverlay.remove();
                    this.onAdRewardEarned();
                };
            }
            
            if (timeLeft <= 0) {
                clearInterval(timer);
                adOverlay.remove();
                this.onAdRewardEarned();
            }
        }, 1000);
    }

    /**
     * Handle successful ad reward
     */
    onAdRewardEarned() {
        // Give player 30 extra seconds
        this.timeLeft += 30;
        this.updateTimerDisplay();
        
        // Hide time up modal and resume game
        document.getElementById('timeUpModal').classList.add('hidden');
        this.gameState = 'playing';
        this.isPaused = false;
        
        // Restart timer
        this.startTimer();
        
        // Show reward notification
        this.showRewardNotification();
        
        console.log('Player earned 30 extra seconds!');
    }

    /**
     * Handle ad failure
     */
    onAdFailed() {
        alert('Ad not available. Try again later.');
    }

    /**
     * Show reward notification
     */
    showRewardNotification() {
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
        notification.innerHTML = `
            <div class="flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="font-bold">+30 seconds added!</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.classList.remove('translate-x-full');
        }, 100);
        
        // Remove after 3 seconds
        setTimeout(() => {
            notification.classList.add('translate-x-full');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    /**
     * Calculate time limit based on level difficulty
     */
    calculateTimeLimit(level) {
        // Set timer to 1 minute (60 seconds) for all levels
        return 60;
    }
    
    /**
     * Start the timer for current level
     */
    startTimer() {
        this.stopTimer(); // Clear any existing timer
        
        this.levelTimeLimit = this.calculateTimeLimit(this.currentLevel);
        this.timeLeft = this.levelTimeLimit;
        
        console.log(`Level ${this.currentLevel} timer started: ${this.timeLeft} seconds`);
        console.log(`Game state: ${this.gameState}, isPaused: ${this.isPaused}`);
        
        // Update display immediately
        this.updateTimerDisplay();
        
        this.timerId = setInterval(() => {
            console.log(`Timer check - gameState: ${this.gameState}, isPaused: ${this.isPaused}, timeLeft: ${this.timeLeft}`);
            
            if (!this.isPaused && (this.gameState === 'playing' || this.gameState === undefined)) {
                this.timeLeft--;
                console.log(`Timer tick: ${this.timeLeft} seconds left`);
                this.updateTimerDisplay();
                
                // Warning at 30 seconds
                if (this.timeLeft === 30) {
                    this.showTimeWarning();
                }
                
                // Time up
                if (this.timeLeft <= 0) {
                    this.timeUp();
                }
            } else {
                console.log('Timer paused or game not playing');
            }
        }, 1000);
    }
    
    /**
     * Stop the timer
     */
    stopTimer() {
        if (this.timerId) {
            clearInterval(this.timerId);
            this.timerId = null;
        }
    }
    
    /**
     * Pause the timer
     */
    pauseTimer() {
        // Timer automatically pauses when isPaused is true
    }
    
    /**
     * Resume the timer
     */
    resumeTimer() {
        // Timer automatically resumes when isPaused is false
    }
    
    /**
     * Handle time up event
     */
    timeUp() {
        this.stopTimer();
        this.gameState = 'timeup';
        this.playSound('error');
        
        // Show rewarded ad immediately when time is up
        setTimeout(() => {
            this.showRewardedAd();
        }, 500);
        
        // Also show time up modal as fallback
        setTimeout(() => {
            document.getElementById('timeUpModal').classList.remove('hidden');
            document.getElementById('timeUpModal').classList.add('modal-enter');
        }, 1000);
    }
    
    /**
     * Show time warning
     */
    showTimeWarning() {
        const timerDisplay = document.getElementById('timerDisplay');
        if (timerDisplay) {
            timerDisplay.classList.add('pulse-animation');
            timerDisplay.style.backgroundColor = 'rgba(239, 68, 68, 0.3)'; // Red warning
            
            setTimeout(() => {
                timerDisplay.classList.remove('pulse-animation');
                timerDisplay.style.backgroundColor = '';
            }, 3000);
        }
        
        // Play warning sound
        this.playSound('error');
    }
    
    /**
     * Update timer display
     */
    updateTimerDisplay() {
        const timeLeftElement = document.getElementById('timeLeft');
        const timerDisplay = document.getElementById('timerDisplay');
        
        console.log(`Updating timer display: ${this.timeLeft} seconds`);
        
        if (timeLeftElement && timerDisplay) {
            const minutes = Math.floor(this.timeLeft / 60);
            const seconds = this.timeLeft % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            timeLeftElement.textContent = timeString;
            
            console.log(`Timer display updated to: ${timeString}`);
            
            // Color coding based on time left
            if (this.timeLeft <= 30) {
                timerDisplay.style.backgroundColor = 'rgba(239, 68, 68, 0.3)'; // Red
                timerDisplay.style.color = '#FEE2E2';
            } else if (this.timeLeft <= 60) {
                timerDisplay.style.backgroundColor = 'rgba(245, 158, 11, 0.3)'; // Orange
                timerDisplay.style.color = '#FEF3C7';
            } else {
                timerDisplay.style.backgroundColor = '';
                timerDisplay.style.color = '';
            }
        } else {
            console.error('Timer elements not found:', { timeLeftElement, timerDisplay });
        }
    }
    
    /**
     * Generate a level based on difficulty progression
     */
    generateLevel(level) {
        console.log(`Generating level ${level}`);
        
        this.tubes = [];
        this.selectedTube = -1;
        this.moves = 0;
        this.moveHistory = [];
        this.animatingBall = null;
        this.hintsUsed = 0;
        this.shufflesUsed = 0;
        this.gameState = 'playing';
        this.isPaused = false; // Ensure timer can run
        
        // Track level start time for progress manager
        this.levelStartTime = Date.now();
        
        console.log(`Game state set to: ${this.gameState}, isPaused: ${this.isPaused}`);
        
        // Progressive difficulty
        let config = this.getLevelConfig(level);
        
        // Create tubes
        for (let i = 0; i < config.totalTubes; i++) {
            this.tubes.push([]);
        }
        
        // Create a mixed puzzle instead of starting from solved state
        this.createMixedPuzzle(config);
        
        // Start the timer for this level
        console.log('Starting timer...');
        this.startTimer();
        
        // Save the new level state
        this.saveGameState();
    }
    
    /**
     * Get level configuration based on difficulty progression
     */
    getLevelConfig(level) {
        if (level <= 5) {
            // Beginner levels
            return {
                colors: Math.min(2 + Math.floor(level / 2), 4),
                ballsPerColor: 4,
                totalTubes: 5,
                filledTubes: 4,
                emptyTubes: 1
            };
        } else if (level <= 15) {
            // Intermediate levels
            return {
                colors: Math.min(3 + Math.floor(level / 3), 6),
                ballsPerColor: 4,
                totalTubes: 6 + Math.floor(level / 5),
                filledTubes: 5 + Math.floor(level / 5),
                emptyTubes: 1 + Math.floor(level / 10)
            };
        } else {
            // Advanced levels
            return {
                colors: Math.min(4 + Math.floor(level / 4), 8),
                ballsPerColor: 4,
                totalTubes: 7 + Math.floor(level / 3),
                filledTubes: 6 + Math.floor(level / 3),
                emptyTubes: 1 + Math.floor(level / 8)
            };
        }
    }
    
    /**
     * Create a mixed puzzle that's definitely not solved
     */
    createMixedPuzzle(config) {
        // Create all balls
        let allBalls = [];
        for (let color = 0; color < config.colors; color++) {
            for (let i = 0; i < config.ballsPerColor; i++) {
                allBalls.push(color);
            }
        }
        
        // Shuffle all balls thoroughly
        this.shuffleArray(allBalls);
        this.shuffleArray(allBalls); // Shuffle twice for better mixing
        
        // Distribute balls ensuring no tube is complete
        let filledTubes = config.totalTubes - 1; // Leave at least one empty tube
        let ballsPerFilledTube = Math.floor(allBalls.length / filledTubes);
        let extraBalls = allBalls.length % filledTubes;
        
        let ballIndex = 0;
        for (let tubeIndex = 0; tubeIndex < filledTubes; tubeIndex++) {
            let ballsForThisTube = ballsPerFilledTube + (tubeIndex < extraBalls ? 1 : 0);
            
            for (let i = 0; i < ballsForThisTube && ballIndex < allBalls.length; i++) {
                this.tubes[tubeIndex].push(allBalls[ballIndex]);
                ballIndex++;
            }
            
            // Ensure this tube is NOT solved by checking if all balls are same color
            if (this.tubes[tubeIndex].length === config.ballsPerColor) {
                let firstColor = this.tubes[tubeIndex][0];
                if (this.tubes[tubeIndex].every(ball => ball === firstColor)) {
                    // This tube is solved, mix it up
                    let nextTube = (tubeIndex + 1) % config.totalTubes;
                    if (this.tubes[nextTube].length < this.maxBallsPerTube) {
                        // Move one ball to next tube
                        let ballToMove = this.tubes[tubeIndex].pop();
                        this.tubes[nextTube].push(ballToMove);
                    }
                }
            }
        }
        
        // Double-check no tube is complete
        for (let i = 0; i < this.tubes.length; i++) {
            if (this.tubes[i].length === config.ballsPerColor) {
                let firstColor = this.tubes[i][0];
                if (this.tubes[i].every(ball => ball === firstColor)) {
                    // Found a complete tube, scramble it
                    let tubeToScramble = this.tubes[i].slice();
                    this.tubes[i] = [];
                    
                    // Redistribute these balls
                    for (let ball of tubeToScramble) {
                        let targetTube = Math.floor(Math.random() * (this.tubes.length - 1));
                        if (this.tubes[targetTube].length < this.maxBallsPerTube) {
                            this.tubes[targetTube].push(ball);
                        } else {
                            // Find any tube with space
                            for (let j = 0; j < this.tubes.length; j++) {
                                if (this.tubes[j].length < this.maxBallsPerTube) {
                                    this.tubes[j].push(ball);
                                    break;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    
    /**
     * Setup event listeners for game controls
     */
    setupEventListeners() {
        // Canvas click events
        this.canvas.addEventListener('click', (e) => this.handleCanvasClick(e));
        this.canvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
        
        // UI button events
        document.getElementById('undoBtn').addEventListener('click', () => this.undoMove());
        document.getElementById('hintBtn').addEventListener('click', () => this.showHint());
        document.getElementById('shuffleBtn').addEventListener('click', () => this.shuffleBalls());
        document.getElementById('restartBtn').addEventListener('click', () => this.restartLevel());
        document.getElementById('pauseBtn').addEventListener('click', () => this.pauseGame());
        document.getElementById('soundToggle').addEventListener('click', () => this.toggleSound());
        document.getElementById('testSoundBtn').addEventListener('click', () => {
            console.log('Test sound button clicked');
            this.playSound('pop');
        });
        
        // Modal events
        document.getElementById('nextLevelBtn').addEventListener('click', () => this.nextLevel());
        document.getElementById('replayBtn').addEventListener('click', () => this.restartLevel());
        document.getElementById('resumeBtn').addEventListener('click', () => this.resumeGame());
        document.getElementById('mainMenuBtn').addEventListener('click', () => this.goToMainMenu());
        document.getElementById('retryLevelBtn').addEventListener('click', () => this.restartLevel());
        document.getElementById('watchAdBtn').addEventListener('click', () => this.showRewardedAd());
        
        // Keyboard events
        document.addEventListener('keydown', (e) => this.handleKeyPress(e));
        
        // Window events
        window.addEventListener('beforeunload', () => this.saveGameState());
        window.addEventListener('load', () => this.loadGameState());
    }
    
    /**
     * Handle canvas click events for tube selection and ball movement
     */
    handleCanvasClick(e) {
        if (this.isPaused || this.animatingBall) return;
        
        const rect = this.canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const tubeIndex = this.getTubeAtPosition(x, y);
        
        if (tubeIndex !== -1) {
            if (this.selectedTube === -1) {
                // Select tube if it has balls
                if (this.tubes[tubeIndex].length > 0) {
                    this.selectedTube = tubeIndex;
                    this.playSound('select');
                }
            } else {
                // Try to move ball
                if (tubeIndex === this.selectedTube) {
                    // Deselect same tube
                    this.selectedTube = -1;
                } else {
                    // Attempt move
                    if (this.isValidMove(this.selectedTube, tubeIndex)) {
                        this.moveBall(this.selectedTube, tubeIndex);
                        this.selectedTube = -1;
                    } else {
                        // Invalid move - shake animation and error sound
                        this.addShakeEffect(tubeIndex);
                        this.playSound('error');
                        this.selectedTube = -1;
                    }
                }
            }
        } else {
            // Click outside tubes - deselect
            this.selectedTube = -1;
        }
    }
    
    /**
     * Handle mouse movement for hover effects
     */
    handleMouseMove(e) {
        if (this.isPaused) return;
        
        const rect = this.canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const tubeIndex = this.getTubeAtPosition(x, y);
        this.canvas.style.cursor = tubeIndex !== -1 ? 'pointer' : 'default';
    }
    
    /**
     * Get tube index at given position
     */
    getTubeAtPosition(x, y) {
        const startX = (this.canvas.width - (this.tubes.length * (this.tubeWidth + 20) - 20)) / 2;
        const tubeY = this.canvas.height - this.tubeHeight - 50;
        
        for (let i = 0; i < this.tubes.length; i++) {
            const tubeX = startX + i * (this.tubeWidth + 20);
            
            if (x >= tubeX && x <= tubeX + this.tubeWidth &&
                y >= tubeY && y <= tubeY + this.tubeHeight) {
                return i;
            }
        }
        return -1;
    }
    
    /**
     * Check if a move from one tube to another is valid
     */
    isValidMove(fromTube, toTube) {
        if (fromTube === toTube) return false;
        if (this.tubes[fromTube].length === 0) return false;
        if (this.tubes[toTube].length >= this.maxBallsPerTube) return false;
        
        const fromBall = this.tubes[fromTube][this.tubes[fromTube].length - 1];
        
        if (this.tubes[toTube].length === 0) return true;
        
        const toBall = this.tubes[toTube][this.tubes[toTube].length - 1];
        return fromBall === toBall;
    }
    
    /**
     * Move a ball from one tube to another with animation
     */
    moveBall(fromTube, toTube, recordMove = true) {
        if (!this.isValidMove(fromTube, toTube)) return false;
        
        const ball = this.tubes[fromTube].pop();
        
        // Record move for undo
        if (recordMove) {
            this.moveHistory.push({ from: fromTube, to: toTube, ball: ball });
            this.moves++;
        }
        
        // Start animation
        this.animatingBall = {
            ball: ball,
            fromTube: fromTube,
            toTube: toTube,
            progress: 0
        };
        
        this.playSound('transfer');
        this.updateUI();
        
        // Save game state after each move
        this.saveGameState();
        
        return true;
    }
    
    /**
     * Complete ball animation and check for level completion
     */
    completeBallAnimation() {
        if (!this.animatingBall) return;
        
        console.log("Completing ball animation...");
        
        this.tubes[this.animatingBall.toTube].push(this.animatingBall.ball);
        this.animatingBall = null;
        
        // Check for level completion
        console.log("Checking if level is complete...");
        if (this.isLevelComplete()) {
            console.log("Level complete detected! Calling completeLevel()");
            this.completeLevel();
        } else {
            console.log("Level not complete yet");
        }
    }
    
    /**
     * Check if current level is complete
     */
    isLevelComplete() {
        // Get level config to know how many balls per color we should have
        let config = this.getLevelConfig(this.currentLevel);
        let colorCounts = new Array(config.colors).fill(0);
        
        console.log(`Checking level completion for level ${this.currentLevel}, expecting ${config.colors} colors with ${config.ballsPerColor} balls each`);
        
        // Count balls of each color and check tube validity
        for (let tube of this.tubes) {
            if (tube.length === 0) continue;
            
            // Check if all balls in tube are same color
            const firstBall = tube[0];
            for (let ball of tube) {
                if (ball !== firstBall) {
                    console.log(`Mixed colors in tube: ${JSON.stringify(tube)}`);
                    return false;
                }
            }
            
            // Count this color
            colorCounts[firstBall] += tube.length;
        }
        
        console.log(`Color counts: ${JSON.stringify(colorCounts)}`);
        
        // Check if each color has the correct number of balls (ballsPerColor)
        for (let count of colorCounts) {
            if (count !== 0 && count !== config.ballsPerColor) {
                console.log(`Incorrect color count: ${count}, expected: ${config.ballsPerColor}`);
                return false;
            }
        }
        
        // Must have at least some completed tubes (not all empty)
        let completedTubes = 0;
        for (let tube of this.tubes) {
            if (tube.length === config.ballsPerColor) {
                completedTubes++;
            }
        }
        
        console.log(`Completed tubes: ${completedTubes}, expected: ${config.colors}`);
        const isComplete = completedTubes === config.colors;
        
        if (isComplete) {
            console.log("LEVEL IS COMPLETE!");
        }
        
        return isComplete;
    }
    
    /**
     * Handle level completion
     */
    completeLevel() {
        console.log("ðŸŽ‰ COMPLETE LEVEL CALLED! ðŸŽ‰");
        this.stopTimer(); // Stop the timer
        this.gameState = 'completed';
        this.playSound('victory');
        // Play congratulations sound after a short delay
        setTimeout(() => {
            this.playSound('congratulations');
        }, 800);
        this.createVictoryEffect();
        
        // Calculate completion stats
        const timeSpent = this.levelTimeLimit - this.timeLeft;
        const levelEndTime = Date.now();
        const totalTimeSpent = Math.floor((levelEndTime - this.levelStartTime) / 1000);
        
        console.log(`Level ${this.currentLevel} completed in ${this.moves} moves, ${totalTimeSpent}s`);
        
        // Update user progress with the progress manager
        if (this.progressManager) {
            // Record level completion
            this.progressManager.addGameCompletion(
                this.currentLevel, 
                this.moves, 
                totalTimeSpent
            );
            
            // Update maximum level reached  
            this.progressManager.updateMaxLevel(this.currentLevel + 1);
            this.maxLevelReached = this.currentLevel + 1;
            console.log(`Max level updated to: ${this.maxLevelReached}`);
        }
        
        // Update final moves display
        document.getElementById('finalMoves').textContent = this.moves;
        
        console.log("About to show victory modal...");
        
        // Show victory modal
        setTimeout(() => {
            console.log("Showing victory modal now!");
            document.getElementById('victoryModal').classList.remove('hidden');
            document.getElementById('victoryModal').classList.add('modal-enter');
        }, 1000);
        
        this.saveGameState();
    }
    
    /**
     * Calculate optimal number of moves for a level
     */
    calculateOptimalMoves(level) {
        const config = this.getLevelConfig(level);
        // Rough estimate: each ball needs to move at least once
        // More complex levels need more moves due to blocking
        return Math.floor(config.colors * config.ballsPerColor * 1.5);
    }

    /**
     * Show achievement notifications
     */
    showAchievementNotifications(achievements) {
        achievements.forEach((achievement, index) => {
            setTimeout(() => {
                this.showAchievementNotification(achievement);
            }, index * 2000); // Stagger notifications
        });
    }

    /**
     * Show single achievement notification
     */
    showAchievementNotification(achievement) {
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 bg-yellow-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-500 max-w-sm';
        notification.innerHTML = `
            <div class="flex items-center">
                <div class="text-2xl mr-3">ðŸ†</div>
                <div>
                    <div class="font-bold text-lg">Achievement Unlocked!</div>
                    <div class="font-semibold">${achievement.name}</div>
                    <div class="text-sm opacity-90">${achievement.description}</div>
                </div>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.classList.remove('translate-x-full');
        }, 100);
        
        // Remove after 5 seconds
        setTimeout(() => {
            notification.classList.add('translate-x-full');
            setTimeout(() => notification.remove(), 500);
        }, 5000);
        
        // Play achievement sound
        this.playSound('victory');
    }

    /**
     * Show perfect level notification
     */
    showPerfectLevelNotification() {
        const notification = document.createElement('div');
        notification.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-6 rounded-xl shadow-2xl z-50 text-center';
        notification.innerHTML = `
            <div class="text-4xl mb-2">â­</div>
            <div class="text-xl font-bold mb-1">PERFECT!</div>
            <div class="text-sm">Completed with optimal moves!</div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate and remove
        setTimeout(() => {
            notification.style.transform = 'translate(-50%, -50%) scale(1.1)';
        }, 100);
        
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transform = 'translate(-50%, -50%) scale(0.8)';
            setTimeout(() => notification.remove(), 300);
        }, 2000);
    }

    /**
     * Update the ad reward method to track stats
     */
    onAdRewardEarned() {
        // Give player 30 extra seconds
        this.timeLeft += 30;
        this.updateTimerDisplay();
        
        // Track ad watched
        if (this.progressManager) {
            this.progressManager.recordAdWatched();
        }
        
        // Hide time up modal and resume game
        document.getElementById('timeUpModal').classList.add('hidden');
        this.gameState = 'playing';
        this.isPaused = false;
        
        // Restart timer
        this.startTimer();
        
        // Show reward notification
        this.showRewardNotification();
        
        console.log('Player earned 30 extra seconds!');
    }

    /**
     * Create victory particle effect
     */
    createVictoryEffect() {
        for (let i = 0; i < 50; i++) {
            this.particles.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10,
                life: 60,
                color: this.ballColors[Math.floor(Math.random() * this.ballColors.length)]
            });
        }
    }
    
    /**
     * Undo the last move
     */
    undoMove() {
        if (this.moveHistory.length === 0 || this.animatingBall) return;
        
        const lastMove = this.moveHistory.pop();
        const ball = this.tubes[lastMove.to].pop();
        this.tubes[lastMove.from].push(ball);
        
        this.moves = Math.max(0, this.moves - 1);
        this.updateUI();
        this.playSound('pop');
    }
    
    /**
     * Show hint by highlighting a valid move
     */
    showHint() {
        if (this.hintsUsed >= this.maxHints || this.animatingBall) return;
        
        // Find a valid move
        for (let from = 0; from < this.tubes.length; from++) {
            for (let to = 0; to < this.tubes.length; to++) {
                if (this.isValidMove(from, to)) {
                    // Highlight the hint
                    this.selectedTube = from;
                    this.hintsUsed++;
                    this.updateUI();
                    
                    setTimeout(() => {
                        this.selectedTube = -1;
                    }, 2000);
                    
                    return;
                }
            }
        }
    }
    
    /**
     * Shuffle balls in tubes (limited use)
     */
    shuffleBalls() {
        if (this.shufflesUsed >= this.maxShuffles || this.animatingBall) return;
        
        // Collect all balls
        let allBalls = [];
        for (let tube of this.tubes) {
            allBalls.push(...tube);
            tube.length = 0;
        }
        
        // Shuffle and redistribute
        this.shuffleArray(allBalls);
        
        let tubeIndex = 0;
        for (let ball of allBalls) {
            if (this.tubes[tubeIndex].length >= this.maxBallsPerTube) {
                tubeIndex = (tubeIndex + 1) % (this.tubes.length - 1); // Keep some tubes empty
            }
            this.tubes[tubeIndex].push(ball);
        }
        
        this.shufflesUsed++;
        this.updateUI();
    }
    
    /**
     * Restart current level
     */
    restartLevel() {
        this.generateLevel(this.currentLevel);
        this.updateUI();
        this.hideModals();
    }
    
    /**
     * Go to next level
     */
    nextLevel() {
        if (this.currentLevel < this.maxLevel) {
            this.currentLevel++;
            this.maxLevelReached = Math.max(this.currentLevel, this.maxLevelReached);
            this.generateLevel(this.currentLevel);
            this.updateUI();
            this.saveGameState(); // Save progress when advancing levels
        }
        this.hideModals();
    }
    
    /**
     * Pause/resume game
     */
    pauseGame() {
        this.isPaused = true;
        this.saveGameState(); // Save when pausing
        this.showBannerAd(); // Show banner during pause
        document.getElementById('pauseModal').classList.remove('hidden');
    }

    resumeGame() {
        this.isPaused = false;
        this.hideModals();
        // Keep banner visible during gameplay for continuous revenue
    }    /**
     * Go to main menu (restart from level 1)
     */
    goToMainMenu() {
        this.currentLevel = 1;
        this.generateLevel(this.currentLevel);
        this.updateUI();
        this.hideModals();
    }
    
    /**
     * Hide all modals
     */
    hideModals() {
        document.getElementById('victoryModal').classList.add('hidden');
        document.getElementById('pauseModal').classList.add('hidden');
        document.getElementById('timeUpModal').classList.add('hidden');
        
        // Clean up any dynamically added time bonus elements
        const finalMovesElement = document.getElementById('finalMoves').parentElement;
        const timeBonusElements = finalMovesElement.querySelectorAll('p:not(:first-child)');
        timeBonusElements.forEach(element => element.remove());
        
        this.gameState = 'playing';
        this.isPaused = false;
    }
    
    /**
     * Handle keyboard input
     */
    handleKeyPress(e) {
        if (this.isPaused) return;
        
        switch (e.key) {
            case 'Escape':
                this.pauseGame();
                break;
            case 'r':
            case 'R':
                this.restartLevel();
                break;
            case 'u':
            case 'U':
                this.undoMove();
                break;
            case 'h':
            case 'H':
                this.showHint();
                break;
        }
    }
    
    /**
     * Add shake effect to tube
     */
    addShakeEffect(tubeIndex) {
        this.shakeEffects.push({
            tube: tubeIndex,
            intensity: 10,
            duration: 30
        });
    }
    
    /**
     * Toggle sound on/off
     */
    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        console.log('Sound toggled:', this.soundEnabled ? 'ON' : 'OFF');
        this.updateSoundButton();
        
        // Play a test sound if enabling
        if (this.soundEnabled) {
            setTimeout(() => this.playSound('pop'), 200);
        }
    }
    
    /**
     * Update sound button appearance
     */
    updateSoundButton() {
        const soundButton = document.getElementById('soundToggle');
        if (soundButton) {
            soundButton.textContent = this.soundEnabled ? 'ðŸ”Š' : 'ðŸ”‡';
            soundButton.title = this.soundEnabled ? 'Sound On (Click to mute)' : 'Sound Off (Click to unmute)';
        }
    }
    
    /**
     * Create HTML5 audio elements with base64 encoded sounds
     */
    createAudioElements() {
        try {
            // Create tube selection sound (pleasant chime)
            this.selectAudio = new Audio();
            this.selectAudio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QPwkUX7br66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2Q==';
            this.selectAudio.volume = 0.2;
            
            // Create ball transfer sound (soft pop/whoosh)
            this.transferAudio = new Audio();
            this.transferAudio.src = 'data:audio/wav;base64,UklGRpYFAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YXIFAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QPwkUX7br66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2Q==';
            this.transferAudio.volume = 0.25;
            
            // Create congratulations sound (fanfare)
            this.congratsAudio = new Audio();
            this.congratsAudio.src = 'data:audio/wav;base64,UklGRvAIAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YcwIAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QPwkUX7br66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2Q==';
            this.congratsAudio.volume = 0.6;
            
            // Create pop sound (short beep)
            this.popAudio = new Audio();
            this.popAudio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QPwkUX7br66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2Q==';
            this.popAudio.volume = 0.3;
            
            // Create error sound (low tone)
            this.errorAudio = new Audio();
            this.errorAudio.src = 'data:audio/wav;base64,UklGRjYDAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YRIAAACAAAD//wAA//8AAP//AACAAAD//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//wAAAACAAP//AAD//wAA//8AAID//wAA//8AAP//AAD//w==';
            this.errorAudio.volume = 0.2;
            
            // Create victory sound  
            this.victoryAudio = new Audio();
            this.victoryAudio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QPwkUX7br66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2Q==';
            this.victoryAudio.volume = 0.4;
            
            console.log('Enhanced audio elements created successfully');
            this.audioInitialized = true;
        } catch (e) {
            console.error('Failed to create audio elements:', e);
            this.soundEnabled = false;
        }
    }
    
    /**
     * Simple and reliable audio playback
     */
    playSound(type) {
        if (!this.soundEnabled || !this.audioInitialized) {
            console.log('Sound disabled or not initialized');
            return;
        }
        
        console.log(`Attempting to play sound: ${type}`);
        
        try {
            let audio = null;
            
            if (type === 'select' && this.selectAudio) {
                audio = this.selectAudio;
            } else if (type === 'transfer' && this.transferAudio) {
                audio = this.transferAudio;
            } else if (type === 'congratulations' && this.congratsAudio) {
                audio = this.congratsAudio;
            } else if (type === 'pop' && this.popAudio) {
                audio = this.popAudio;
            } else if (type === 'error' && this.errorAudio) {
                audio = this.errorAudio;
            } else if (type === 'victory' && this.victoryAudio) {
                audio = this.victoryAudio;
            }
            
            if (audio) {
                // Reset to beginning and play
                audio.currentTime = 0;
                const playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log(`${type} sound played successfully`);
                    }).catch(error => {
                        console.error(`Failed to play ${type} sound:`, error);
                        // Show user notification if audio fails
                        this.showAudioError();
                    });
                }
            }
        } catch (e) {
            console.error('Sound playback error:', e);
        }
    }
    
    /**
     * Show audio error notification
     */
    showAudioError() {
        const gameMessage = document.getElementById('gameMessage');
        if (gameMessage) {
            const originalText = gameMessage.textContent;
            gameMessage.textContent = 'Audio blocked by browser - click sound button to enable!';
            gameMessage.style.color = '#FFB84D';
            setTimeout(() => {
                gameMessage.textContent = originalText;
                gameMessage.style.color = '';
            }, 3000);
        }
    }
    
    /**
     * Update UI elements
     */
    updateUI() {
        document.getElementById('levelDisplay').textContent = this.currentLevel;
        document.getElementById('moveCounter').textContent = this.moves;
        
        // Update button states
        document.getElementById('undoBtn').disabled = this.moveHistory.length === 0;
        document.getElementById('hintBtn').disabled = this.hintsUsed >= this.maxHints;
        document.getElementById('shuffleBtn').disabled = this.shufflesUsed >= this.maxShuffles;
        
        // Update button text to show remaining uses
        document.getElementById('hintBtn').textContent = `Hint (${this.maxHints - this.hintsUsed})`;
        document.getElementById('shuffleBtn').textContent = `Shuffle (${this.maxShuffles - this.shufflesUsed})`;
        
        // Update sound button
        this.updateSoundButton();
    }
    
    /**
     * Save game state to localStorage
     */
    saveGameState() {
        const gameState = {
            currentLevel: this.currentLevel,
            maxLevelReached: Math.max(this.currentLevel, this.maxLevelReached || 1),
            tubes: this.tubes,
            moves: this.moves,
            moveHistory: this.moveHistory,
            hintsUsed: this.hintsUsed,
            shufflesUsed: this.shufflesUsed,
            timeLeft: this.timeLeft,
            levelTimeLimit: this.levelTimeLimit,
            gameState: this.gameState,
            soundEnabled: this.soundEnabled,
            lastPlayedTime: Date.now()
        };
        
        try {
            localStorage.setItem('ballSortGame', JSON.stringify(gameState));
            console.log(`Game state saved - Level: ${this.currentLevel}, Moves: ${this.moves}`);
        } catch (e) {
            console.error('Failed to save game state:', e);
        }
    }
    
    /**
     * Load game state from localStorage
     */
    async loadGameState() {
        try {
            // Wait for progress manager to initialize
            if (this.progressManager) {
                await this.progressManager.loadUserProgress();
                
                // Get the maximum level reached from progress manager
                const maxLevelFromProgress = this.progressManager.userData.maxLevelReached;
                console.log(`Max level from progress manager: ${maxLevelFromProgress}`);
                
                // Update our max level
                this.maxLevelReached = maxLevelFromProgress;
            }
            
            const savedState = localStorage.getItem('ballSortGame');
            if (savedState) {
                console.log('Loading saved game state...');
                const gameState = JSON.parse(savedState);
                
                // Restore level progress, but ensure it doesn't exceed progress manager max
                this.currentLevel = Math.min(gameState.currentLevel || 1, this.maxLevelReached);
                this.tubes = gameState.tubes || [];
                this.moves = gameState.moves || 0;
                this.moveHistory = gameState.moveHistory || [];
                this.hintsUsed = gameState.hintsUsed || 0;
                this.shufflesUsed = gameState.shufflesUsed || 0;
                this.timeLeft = gameState.timeLeft || 0;
                this.levelTimeLimit = gameState.levelTimeLimit || 0;
                this.soundEnabled = gameState.soundEnabled !== undefined ? gameState.soundEnabled : true;
                
                console.log(`Restored to level ${this.currentLevel} (max reached: ${this.maxLevelReached}) with ${this.moves} moves`);
                
                // If we have valid saved game state, restore it
                if (this.tubes.length > 0) {
                    // Resume timer if there was time left and game was in progress
                    if (this.timeLeft > 0 && !this.isGameWon()) {
                        this.startTimer();
                        this.timeLeft = gameState.timeLeft; // Restore exact saved time
                        console.log(`Resuming timer with ${this.timeLeft} seconds`);
                    }
                    this.updateUI();
                } else {
                    // No valid level data, generate the current level fresh
                    console.log(`No level data found, generating level ${this.currentLevel}`);
                    this.generateLevel(this.currentLevel);
                }
            } else {
                // No saved state, start from highest unlocked level
                this.currentLevel = this.maxLevelReached;
                console.log(`No saved state found, starting from max level: ${this.currentLevel}`);
                this.initializeGame();
            }
        } catch (e) {
            console.error('Error loading saved state:', e);
            // Invalid saved state, start fresh
            this.initializeGame();
        }
    }
    
    /**
     * Utility function to shuffle array
     */
    shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }
    
    /**
     * Main game loop for rendering and animations
     */
    gameLoop() {
        this.update();
        this.render();
        requestAnimationFrame(() => this.gameLoop());
    }
    
    /**
     * Update game state and animations
     */
    update() {
        // Update ball animation
        if (this.animatingBall) {
            this.animatingBall.progress += 0.05;
            if (this.animatingBall.progress >= 1) {
                this.completeBallAnimation();
            }
        }
        
        // Update particles
        this.particles = this.particles.filter(particle => {
            particle.x += particle.vx;
            particle.y += particle.vy;
            particle.vy += 0.3; // Gravity
            particle.life--;
            return particle.life > 0;
        });
        
        // Update shake effects
        this.shakeEffects = this.shakeEffects.filter(effect => {
            effect.duration--;
            effect.intensity *= 0.9;
            return effect.duration > 0;
        });
    }
    
    /**
     * Render the game
     */
    render() {
        // Clear canvas
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        // Draw background pattern
        this.drawBackground();
        
        // Draw tubes and balls
        this.drawTubes();
        
        // Draw animating ball
        if (this.animatingBall) {
            this.drawAnimatingBall();
        }
        
        // Draw particles
        this.drawParticles();
        
        // Draw UI elements
        this.drawLevelInfo();
    }
    
    /**
     * Draw background pattern
     */
    drawBackground() {
        const gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, this.canvas.height);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0.05)');
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0.1)');
        this.ctx.fillStyle = gradient;
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        
        // Draw subtle grid pattern
        this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
        this.ctx.lineWidth = 1;
        for (let x = 0; x < this.canvas.width; x += 40) {
            this.ctx.beginPath();
            this.ctx.moveTo(x, 0);
            this.ctx.lineTo(x, this.canvas.height);
            this.ctx.stroke();
        }
        for (let y = 0; y < this.canvas.height; y += 40) {
            this.ctx.beginPath();
            this.ctx.moveTo(0, y);
            this.ctx.lineTo(this.canvas.width, y);
            this.ctx.stroke();
        }
    }
    
    /**
     * Draw all tubes and their balls
     */
    drawTubes() {
        const startX = (this.canvas.width - (this.tubes.length * (this.tubeWidth + 20) - 20)) / 2;
        const tubeY = this.canvas.height - this.tubeHeight - 50;
        
        for (let i = 0; i < this.tubes.length; i++) {
            let tubeX = startX + i * (this.tubeWidth + 20);
            
            // Apply shake effect
            const shakeEffect = this.shakeEffects.find(effect => effect.tube === i);
            if (shakeEffect) {
                tubeX += (Math.random() - 0.5) * shakeEffect.intensity;
            }
            
            this.drawTube(tubeX, tubeY, i);
            this.drawBallsInTube(tubeX, tubeY, i);
        }
    }
    
    /**
     * Draw a single tube
     */
    drawTube(x, y, tubeIndex) {
        // Tube shadow
        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        this.ctx.fillRect(x + 3, y + 3, this.tubeWidth, this.tubeHeight);
        
        // Tube body
        const gradient = this.ctx.createLinearGradient(x, y, x + this.tubeWidth, y);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
        gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.9)');
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0.7)');
        this.ctx.fillStyle = gradient;
        this.ctx.fillRect(x, y, this.tubeWidth, this.tubeHeight);
        
        // Tube border
        if (tubeIndex === this.selectedTube) {
            this.ctx.strokeStyle = '#FFD700';
            this.ctx.lineWidth = 4;
        } else {
            this.ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
            this.ctx.lineWidth = 2;
        }
        this.ctx.strokeRect(x, y, this.tubeWidth, this.tubeHeight);
        
        // Tube cap
        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
        this.ctx.fillRect(x - 5, y - 10, this.tubeWidth + 10, 10);
        this.ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
        this.ctx.lineWidth = 2;
        this.ctx.strokeRect(x - 5, y - 10, this.tubeWidth + 10, 10);
    }
    
    /**
     * Draw balls in a tube
     */
    drawBallsInTube(tubeX, tubeY, tubeIndex) {
        const balls = this.tubes[tubeIndex];
        
        for (let j = 0; j < balls.length; j++) {
            const ballY = tubeY + this.tubeHeight - (j + 1) * (this.ballSize * 2 + this.ballSpacing) - this.ballSpacing;
            const ballX = tubeX + this.tubeWidth / 2;
            
            this.drawBall(ballX, ballY, balls[j]);
        }
    }
    
    /**
     * Draw a single ball
     */
    drawBall(x, y, colorIndex) {
        const color = this.ballColors[colorIndex];
        
        // Ball shadow
        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
        this.ctx.beginPath();
        this.ctx.arc(x + 2, y + 2, this.ballSize, 0, Math.PI * 2);
        this.ctx.fill();
        
        // Ball gradient
        const gradient = this.ctx.createRadialGradient(
            x - this.ballSize * 0.3, y - this.ballSize * 0.3, 0,
            x, y, this.ballSize
        );
        gradient.addColorStop(0, this.lightenColor(color, 40));
        gradient.addColorStop(0.7, color);
        gradient.addColorStop(1, this.darkenColor(color, 20));
        
        this.ctx.fillStyle = gradient;
        this.ctx.beginPath();
        this.ctx.arc(x, y, this.ballSize, 0, Math.PI * 2);
        this.ctx.fill();
        
        // Ball highlight
        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
        this.ctx.beginPath();
        this.ctx.arc(x - this.ballSize * 0.3, y - this.ballSize * 0.3, this.ballSize * 0.3, 0, Math.PI * 2);
        this.ctx.fill();
        
        // Ball border
        this.ctx.strokeStyle = this.darkenColor(color, 30);
        this.ctx.lineWidth = 2;
        this.ctx.beginPath();
        this.ctx.arc(x, y, this.ballSize, 0, Math.PI * 2);
        this.ctx.stroke();
    }
    
    /**
     * Draw animating ball during movement
     */
    drawAnimatingBall() {
        const startX = (this.canvas.width - (this.tubes.length * (this.tubeWidth + 20) - 20)) / 2;
        const tubeY = this.canvas.height - this.tubeHeight - 50;
        
        const fromX = startX + this.animatingBall.fromTube * (this.tubeWidth + 20) + this.tubeWidth / 2;
        const fromY = tubeY + this.tubeHeight - (this.tubes[this.animatingBall.fromTube].length + 1) * (this.ballSize * 2 + this.ballSpacing) - this.ballSpacing;
        
        const toX = startX + this.animatingBall.toTube * (this.tubeWidth + 20) + this.tubeWidth / 2;
        const toY = tubeY + this.tubeHeight - (this.tubes[this.animatingBall.toTube].length + 1) * (this.ballSize * 2 + this.ballSpacing) - this.ballSpacing;
        
        // Smooth easing animation
        const progress = this.easeInOutCubic(this.animatingBall.progress);
        
        // Arc trajectory
        const midY = Math.min(fromY, toY) - 50;
        const arcProgress = progress;
        
        let currentX, currentY;
        if (progress < 0.5) {
            // Rising arc
            const t = progress * 2;
            currentX = fromX + (toX - fromX) * t * 0.5;
            currentY = fromY + (midY - fromY) * this.easeOutQuad(t);
        } else {
            // Falling arc
            const t = (progress - 0.5) * 2;
            currentX = fromX + (toX - fromX) * (0.5 + t * 0.5);
            currentY = midY + (toY - midY) * this.easeInQuad(t);
        }
        
        this.drawBall(currentX, currentY, this.animatingBall.ball);
    }
    
    /**
     * Draw victory particles
     */
    drawParticles() {
        for (let particle of this.particles) {
            this.ctx.save();
            this.ctx.globalAlpha = particle.life / 60;
            this.ctx.fillStyle = particle.color;
            this.ctx.beginPath();
            this.ctx.arc(particle.x, particle.y, 3, 0, Math.PI * 2);
            this.ctx.fill();
            this.ctx.restore();
        }
    }
    
    /**
     * Draw level information
     */
    drawLevelInfo() {
        // Level progress indicator
        const progressWidth = 200;
        const progressHeight = 8;
        const progressX = (this.canvas.width - progressWidth) / 2;
        const progressY = 20;
        
        // Progress background
        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
        this.ctx.fillRect(progressX, progressY, progressWidth, progressHeight);
        
        // Progress fill
        const progress = (this.currentLevel - 1) / (this.maxLevel - 1);
        const gradient = this.ctx.createLinearGradient(progressX, progressY, progressX + progressWidth, progressY);
        gradient.addColorStop(0, '#10B981');
        gradient.addColorStop(0.5, '#3B82F6');
        gradient.addColorStop(1, '#8B5CF6');
        this.ctx.fillStyle = gradient;
        this.ctx.fillRect(progressX, progressY, progressWidth * progress, progressHeight);
        
        // Progress border
        this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
        this.ctx.lineWidth = 1;
        this.ctx.strokeRect(progressX, progressY, progressWidth, progressHeight);
    }
    
    /**
     * Utility functions for color manipulation
     */
    lightenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) + amt;
        const G = (num >> 8 & 0x00FF) + amt;
        const B = (num & 0x0000FF) + amt;
        return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
            (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
            (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }
    
    darkenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) - amt;
        const G = (num >> 8 & 0x00FF) - amt;
        const B = (num & 0x0000FF) - amt;
        return "#" + (0x1000000 + (R > 255 ? 255 : R < 0 ? 0 : R) * 0x10000 +
            (G > 255 ? 255 : G < 0 ? 0 : G) * 0x100 +
            (B > 255 ? 255 : B < 0 ? 0 : B)).toString(16).slice(1);
    }
    
    /**
     * Easing functions for smooth animations
     */
    easeInOutCubic(t) {
        return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
    }
    
    easeOutQuad(t) {
        return 1 - (1 - t) * (1 - t);
    }
    
    easeInQuad(t) {
        return t * t;
    }
}

// Initialize game when page loads
document.addEventListener('DOMContentLoaded', () => {
    new BallSortGame();
});

// Service worker for offline play (optional)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => console.log('SW registered'))
            .catch(error => console.log('SW registration failed'));
    });
}


index-mobile.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com https://cdn.tailwindcss.com 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; media-src *; img-src 'self' data: content:;">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    
    <title>Ball Sort Puzzle Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Cordova Script - MUST be included for mobile app -->
    <script type="text/javascript" src="cordova.js"></script>
    
    <!-- User Progress Management -->
    <script src="user-progress.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 min-h-screen">
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600">
        <div class="text-center p-8 max-w-md mx-4">
            <!-- Animated Logo/Icon -->
            <div class="mb-8 relative">
                <div class="w-32 h-32 mx-auto bg-white/20 backdrop-blur-sm rounded-3xl flex items-center justify-center shadow-2xl animate-bounce">
                    <div class="text-6xl">ðŸŽ¯</div>
                </div>
                <!-- Floating balls animation -->
                <div class="absolute -top-4 -left-4 w-8 h-8 bg-red-400 rounded-full animate-ping opacity-75"></div>
                <div class="absolute -top-2 -right-6 w-6 h-6 bg-blue-400 rounded-full animate-ping opacity-75 animation-delay-300"></div>
                <div class="absolute -bottom-4 -right-2 w-10 h-10 bg-yellow-400 rounded-full animate-ping opacity-75 animation-delay-600"></div>
                <div class="absolute -bottom-2 -left-6 w-7 h-7 bg-green-400 rounded-full animate-ping opacity-75 animation-delay-900"></div>
            </div>
            
            <!-- Game Title -->
            <h1 class="text-5xl font-bold text-white mb-4 drop-shadow-lg animate-pulse">
                Ball Sort
            </h1>
            <h2 class="text-3xl font-semibold text-white/90 mb-6 drop-shadow-md">
                Puzzle Game
            </h2>
            
            <!-- Description -->
            <p class="text-lg text-white/80 mb-8 leading-relaxed">
                Sort colored balls into tubes!<br>
                Challenge your mind with this addictive puzzle game.
            </p>
            
            <!-- Start Game Button -->
            <button id="startGameBtn" class="group relative overflow-hidden bg-white text-purple-600 px-12 py-4 rounded-2xl text-xl font-bold transition-all duration-300 hover:scale-110 hover:shadow-2xl active:scale-95">
                <span class="relative z-10">ðŸŽ® Start Game</span>
                <div class="absolute inset-0 bg-gradient-to-r from-yellow-400 to-orange-400 transform translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>
                <span class="absolute inset-0 flex items-center justify-center text-white font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20">
                    Let's Play! ðŸš€
                </span>
            </button>
            
            <!-- Version/Credits -->
            <div class="mt-8 text-white/60 text-sm">
                <p>ðŸŽ² Version 1.0 | Premium Puzzle Experience</p>
            </div>
        </div>
        
        <!-- Background decoration -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-10 left-10 w-20 h-20 bg-white/10 rounded-full animate-float"></div>
            <div class="absolute top-20 right-20 w-16 h-16 bg-white/10 rounded-full animate-float animation-delay-500"></div>
            <div class="absolute bottom-20 left-20 w-24 h-24 bg-white/10 rounded-full animate-float animation-delay-1000"></div>
            <div class="absolute bottom-10 right-10 w-18 h-18 bg-white/10 rounded-full animate-float animation-delay-1500"></div>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer" class="container mx-auto px-4 py-6">
        <!-- Top Bar -->
        <div id="topBar" class="flex justify-between items-center mb-6 bg-white/20 backdrop-blur-sm rounded-xl p-4 shadow-lg">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold text-white">Ball Sort Puzzle</h1>
                <div class="text-white">
                    <span class="bg-white/20 px-3 py-1 rounded-lg">Level: <span id="levelDisplay">1</span></span>
                </div>
                <div class="text-white">
                    <span id="timerDisplay" class="bg-white/20 px-3 py-1 rounded-lg">Time: <span id="timeLeft">5:00</span></span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button id="soundToggle" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                    ðŸ”Š
                </button>
                <button id="pauseBtn" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                    â¸ï¸
                </button>
                <div class="text-white">
                    <span class="bg-white/20 px-3 py-1 rounded-lg">Moves: <span id="movesDisplay">0</span></span>
                </div>
            </div>
        </div>

        <!-- Banner Ad Container -->
        <div id="bannerAdContainer" class="flex justify-center mb-4">
            <div id="bannerAd" class="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 overflow-hidden">
                <!-- AdMob banner will be inserted here -->
                <div id="bannerAdPlaceholder" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white text-center py-3 px-6 text-sm">
                    ðŸŽ® Support the game - Ad loading...
                </div>
            </div>
        </div>

        <!-- Bottom Controls -->
        <div id="bottomBar" class="flex justify-center space-x-4 mb-6">
            <button id="undoBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Undo
            </button>
            <button id="restartBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg transition-colors">
                Restart
            </button>
            <button id="hintBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors">
                Hint
            </button>
        </div>

        <!-- Game Canvas -->
        <div class="flex justify-center mb-6">
            <canvas id="gameCanvas" class="bg-white/10 backdrop-blur-sm rounded-xl shadow-2xl border border-white/20"></canvas>
        </div>
    </div>

    <!-- Victory Modal -->
    <div id="victoryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center transform scale-0 transition-transform duration-300">
            <div class="text-6xl mb-4">ðŸŽ‰</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Level Complete!</h2>
            <div id="victoryStats" class="text-gray-600 mb-6">
                <!-- Stats will be inserted here -->
            </div>
            <div class="flex justify-center space-x-4">
                <button id="nextLevelBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors">
                    Next Level
                </button>
                <button id="replayLevelBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors">
                    Replay
                </button>
            </div>
        </div>
    </div>

    <!-- Time Up Modal -->
    <div id="timeUpModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
            <div class="text-6xl mb-4">â°</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Time's Up!</h2>
            <p class="text-gray-600 mb-6">Don't worry, you can continue or try again!</p>
            <div class="flex justify-center space-x-4">
                <button id="watchAdBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg transition-colors">
                    Watch Ad (+60s)
                </button>
                <button id="restartTimeUpBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg transition-colors">
                    Restart Level
                </button>
            </div>
        </div>
    </div>

    <!-- Pause Modal -->
    <div id="pauseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
            <div class="text-6xl mb-4">â¸ï¸</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Game Paused</h2>
            <p class="text-gray-600 mb-6">Take a break! Your progress is saved.</p>
            <div class="flex justify-center space-x-4">
                <button id="resumeBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors">
                    Resume
                </button>
                <button id="mainMenuBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors">
                    Main Menu
                </button>
            </div>
        </div>
    </div>

    <!-- Game Script -->
    <script src="game.js"></script>
</body>
</html>


index.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ball Sort Puzzle Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <!-- User Progress Management -->
    <script src="user-progress.js"></script>
    <!-- AdMob Cordova Plugin (for mobile apps) -->
    <script>
        // AdMob will be available when running in Cordova/PhoneGap
        // For web testing, we'll use simulation
    </script>
</head>
<body class="bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 min-h-screen">
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600">
        <div class="text-center p-8 max-w-md mx-4">
            <!-- Animated Logo/Icon -->
            <div class="mb-8 relative">
                <div class="w-32 h-32 mx-auto bg-white/20 backdrop-blur-sm rounded-3xl flex items-center justify-center shadow-2xl animate-bounce">
                    <div class="text-6xl">ðŸŽ¯</div>
                </div>
                <!-- Floating balls animation -->
                <div class="absolute -top-4 -left-4 w-8 h-8 bg-red-400 rounded-full animate-ping opacity-75"></div>
                <div class="absolute -top-2 -right-6 w-6 h-6 bg-blue-400 rounded-full animate-ping opacity-75 animation-delay-300"></div>
                <div class="absolute -bottom-4 -right-2 w-10 h-10 bg-yellow-400 rounded-full animate-ping opacity-75 animation-delay-600"></div>
                <div class="absolute -bottom-2 -left-6 w-7 h-7 bg-green-400 rounded-full animate-ping opacity-75 animation-delay-900"></div>
            </div>
            
            <!-- Game Title -->
            <h1 class="text-5xl font-bold text-white mb-4 drop-shadow-lg animate-pulse">
                Ball Sort
            </h1>
            <h2 class="text-3xl font-semibold text-white/90 mb-6 drop-shadow-md">
                Puzzle Game
            </h2>
            
            <!-- Description -->
            <p class="text-lg text-white/80 mb-8 leading-relaxed">
                Sort colored balls into tubes!<br>
                Challenge your mind with this addictive puzzle game.
            </p>
            
            <!-- Start Game Button -->
            <button id="startGameBtn" class="group relative overflow-hidden bg-white text-purple-600 px-12 py-4 rounded-2xl text-xl font-bold transition-all duration-300 hover:scale-110 hover:shadow-2xl active:scale-95">
                <span class="relative z-10">ðŸŽ® Start Game</span>
                <div class="absolute inset-0 bg-gradient-to-r from-yellow-400 to-orange-400 transform translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>
                <span class="absolute inset-0 flex items-center justify-center text-white font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20">
                    Let's Play! ðŸš€
                </span>
            </button>
            
            <!-- Version/Credits -->
            <div class="mt-8 text-white/60 text-sm">
                <p>ðŸŽ² Version 1.0 | Premium Puzzle Experience</p>
            </div>
        </div>
        
        <!-- Background decoration -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-10 left-10 w-20 h-20 bg-white/10 rounded-full animate-float"></div>
            <div class="absolute top-20 right-20 w-16 h-16 bg-white/10 rounded-full animate-float animation-delay-500"></div>
            <div class="absolute bottom-20 left-20 w-24 h-24 bg-white/10 rounded-full animate-float animation-delay-1000"></div>
            <div class="absolute bottom-10 right-10 w-18 h-18 bg-white/10 rounded-full animate-float animation-delay-1500"></div>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer" class="container mx-auto px-4 py-6">
        <!-- Top Bar -->
        <div id="topBar" class="flex justify-between items-center mb-6 bg-white/20 backdrop-blur-sm rounded-xl p-4 shadow-lg">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold text-white">Ball Sort Puzzle</h1>
                <div class="text-white">
                    <span class="bg-white/20 px-3 py-1 rounded-lg">Level: <span id="levelDisplay">1</span></span>
                </div>
                <div class="text-white">
                    <span id="timerDisplay" class="bg-white/20 px-3 py-1 rounded-lg">Time: <span id="timeLeft">5:00</span></span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-white">
                    <span class="bg-white/20 px-3 py-1 rounded-lg">Moves: <span id="moveCounter">0</span></span>
                </div>
                <button id="soundToggle" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ðŸ”Š
                </button>
                <button id="pauseBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Pause
                </button>
                <button id="restartBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Restart
                </button>
            </div>
        </div>

        <!-- Game Canvas -->
        <div class="flex justify-center mb-6">
            <canvas id="gameCanvas" class="bg-white/10 backdrop-blur-sm rounded-xl shadow-2xl border-2 border-white/20"></canvas>
        </div>

        <!-- Banner Ad Container -->
        <div id="bannerAdContainer" class="flex justify-center mb-4">
            <div id="bannerAd" class="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 overflow-hidden">
                <!-- AdMob banner will be inserted here -->
                <div id="bannerAdPlaceholder" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white text-center py-3 px-6 text-sm">
                    ðŸŽ® Support the game - Ad loading...
                </div>
            </div>
        </div>

        <!-- Bottom Controls -->
        <div id="bottomBar" class="flex justify-center space-x-4 mb-6">
            <button id="undoBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Undo
            </button>
            <button id="hintBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Hint
            </button>
            <button id="shuffleBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Shuffle
            </button>
        </div>

        <!-- Game Info Panel -->
        <div id="infoPanel" class="bg-white/20 backdrop-blur-sm rounded-xl p-4 shadow-lg text-white text-center">
            <p id="gameMessage">Click on a tube to select a ball, then click another tube to move it!</p>
            <button id="testSoundBtn" class="mt-2 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                Test Sound ðŸ”Š
            </button>
        </div>
    </div>

    <!-- Victory Modal -->
    <div id="victoryModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 text-center shadow-2xl max-w-md mx-4">
            <div class="text-6xl mb-4">ðŸŽ‰</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Level Complete!</h2>
            <p class="text-gray-600 mb-2">Moves: <span id="finalMoves">0</span></p>
            <p class="text-gray-600 mb-6">Great job!</p>
            <button id="nextLevelBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors mr-2">
                Next Level
            </button>
            <button id="replayBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors">
                Replay
            </button>
        </div>
    </div>

    <!-- Time Up Modal -->
    <div id="timeUpModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 text-center shadow-2xl max-w-md mx-4">
            <div class="text-6xl mb-4">â°</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Time's Up!</h2>
            <p class="text-gray-600 mb-2">You ran out of time for this level.</p>
            <p class="text-gray-600 mb-6">Watch an ad to get +30 seconds or try again!</p>
            <div class="space-y-3">
                <button id="watchAdBtn" class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors font-bold">
                    ðŸ“º Watch Ad (+30s)
                </button>
                <button id="retryLevelBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors">
                    Try Again
                </button>
            </div>
        </div>
    </div>

    <!-- Pause Modal -->
    <div id="pauseModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 text-center shadow-2xl max-w-md mx-4">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Game Paused</h2>
            <button id="resumeBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors mr-2">
                Resume
            </button>
            <button id="mainMenuBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg transition-colors">
                Main Menu
            </button>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="popSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QPwkUX7br66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2Q=" type="audio/wav">
    </audio>
    
    <audio id="victorySound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QPwkUX7br66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFApGn+DyvmEcBT2Y1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2QQAoUXrTp66hVFAlFnt/yv2IcBTyX1/LBeSsFJ3nJ8N2Q=" type="audio/wav">
    </audio>

    <script src="game.js"></script>
</body>
</html>


mobile-enhancements.js

// Mobile-specific enhancements for game.js

// Add to the constructor of BallSortGame class:
constructor() {
    // ... existing code ...
    
    // Mobile-specific initialization
    this.isMobile = this.detectMobile();
    this.setupMobileFeatures();
    
    // ... rest of existing code ...
}

/**
 * Detect if running on mobile device
 */
detectMobile() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
           typeof window.cordova !== 'undefined';
}

/**
 * Setup mobile-specific features
 */
setupMobileFeatures() {
    if (this.isMobile) {
        // Prevent zoom on double tap
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        });
        
        // Prevent context menu on long press
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // Handle device back button
        document.addEventListener('backbutton', () => {
            if (this.gameState === 'playing') {
                this.pauseGame();
            } else {
                navigator.app.exitApp();
            }
        }, false);
        
        // Handle device pause/resume
        document.addEventListener('pause', () => {
            if (this.gameState === 'playing') {
                this.pauseGame();
            }
        }, false);
        
        document.addEventListener('resume', () => {
            // Resume handled by user interaction
        }, false);
    }
}

/**
 * Enhanced AdMob initialization for mobile
 */
initializeAdMob() {
    if (typeof window.AdMob !== 'undefined') {
        this.admobInitialized = true;
        
        // Initialize AdMob
        window.AdMob.setOptions({
            publisherId: "ca-app-pub-YOUR_ACTUAL_PUBLISHER_ID", // Replace with your ID
            interstitialAdId: "ca-app-pub-YOUR_ACTUAL_INTERSTITIAL_ID", // Replace
            rewardVideoId: "ca-app-pub-YOUR_ACTUAL_REWARDED_ID", // Replace
            isTesting: false, // Set to false for production
            autoShowBanner: false,
            autoShowInterstitial: false,
            autoShowRewarded: false
        });
        
        this.loadRewardedAd();
    } else {
        console.log('AdMob not available - using simulation');
        this.admobInitialized = false;
    }
}

/**
 * Enhanced touch handling for mobile
 */
handleCanvasClick(e) {
    if (this.isPaused || this.animatingBall) return;
    
    // Handle both mouse and touch events
    const rect = this.canvas.getBoundingClientRect();
    const scaleX = this.canvas.width / rect.width;
    const scaleY = this.canvas.height / rect.height;
    
    let clientX, clientY;
    
    if (e.type === 'touchstart' || e.type === 'touchend') {
        e.preventDefault();
        const touch = e.touches[0] || e.changedTouches[0];
        clientX = touch.clientX;
        clientY = touch.clientY;
    } else {
        clientX = e.clientX;
        clientY = e.clientY;
    }
    
    const x = (clientX - rect.left) * scaleX;
    const y = (clientY - rect.top) * scaleY;
    
    this.handleTubeSelection(x, y);
}

/**
 * Add vibration feedback for mobile
 */
addHapticFeedback(type = 'light') {
    if (this.isMobile && typeof navigator.vibrate !== 'undefined') {
        switch (type) {
            case 'light':
                navigator.vibrate(50);
                break;
            case 'medium':
                navigator.vibrate(100);
                break;
            case 'heavy':
                navigator.vibrate(200);
                break;
        }
    }
}

// Update existing methods to include haptic feedback:

// In moveBall method, add:
if (this.isValidMove(fromTube, toTube)) {
    this.addHapticFeedback('light');
    // ... existing move logic
} else {
    this.addHapticFeedback('medium'); // Error feedback
}

// In checkWin method, add:
if (this.isGameWon()) {
    this.addHapticFeedback('heavy'); // Victory feedback
    // ... existing win logic
}

// Update setupEventListeners to handle touch events:
setupEventListeners() {
    // Canvas events - support both mouse and touch
    this.canvas.addEventListener('click', (e) => this.handleCanvasClick(e));
    this.canvas.addEventListener('touchend', (e) => this.handleCanvasClick(e));
    this.canvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
    this.canvas.addEventListener('touchmove', (e) => this.handleMouseMove(e));
    
    // ... rest of existing event listeners
}


mobile-styles.css
/* Mobile-Optimized CSS for Ball Sort Puzzle */

/* Prevent text selection and zoom */
* {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

/* Prevent zoom on input focus */
input, select, textarea {
    font-size: 16px !important;
}

/* Ensure proper viewport */
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    -webkit-overflow-scrolling: touch;
}

/* Canvas responsive sizing */
#gameCanvas {
    max-width: 100vw;
    max-height: 60vh;
    touch-action: none;
}

/* Mobile-friendly buttons */
button {
    min-height: 44px;
    min-width: 44px;
    padding: 12px 20px;
    font-size: 16px;
    border-radius: 8px;
    touch-action: manipulation;
}

/* Improve touch targets */
.touch-target {
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Status bar spacing for Android */
.status-bar-padding {
    padding-top: env(safe-area-inset-top);
}

/* Responsive game container */
@media screen and (max-width: 768px) {
    #gameContainer {
        padding: 8px;
    }
    
    #topBar {
        padding: 8px 12px;
        flex-wrap: wrap;
    }
    
    .modal-content {
        margin: 16px;
        max-width: calc(100vw - 32px);
    }
}

/* Portrait orientation optimization */
@media screen and (orientation: portrait) {
    #gameCanvas {
        width: 100%;
        height: auto;
    }
}

/* Landscape orientation (if supported) */
@media screen and (orientation: landscape) {
    #gameCanvas {
        height: 70vh;
        width: auto;
    }
}


README.md

# Ball Sort Puzzle Game

A fully functional 2D Ball Sorting Puzzle Game built with HTML5 Canvas, JavaScript, and Tailwind CSS.

## ðŸŽ® Game Features

### Core Gameplay
- **Objective**: Sort colored balls into tubes so each tube contains only one color
- **Rules**: 
  - Only move the top ball from each tube
  - Balls can only be placed on empty tubes or on top of same-colored balls
  - Complete the level when all tubes have single colors

### Progressive Difficulty
- **Beginner Levels (1-5)**: 3-4 tubes, 2-3 colors, 1 empty tube
- **Intermediate Levels (6-15)**: 5-6 tubes, 4-5 colors, more complex arrangements
- **Advanced Levels (16+)**: 7-8 tubes, 6+ colors, challenging puzzles

### Game Features
- **Move Counter**: Track your efficiency
- **Undo System**: Take back mistakes
- **Hint System**: Get help when stuck (3 hints per level)
- **Shuffle Option**: Reorganize balls (2 shuffles per level)
- **Auto-save**: Progress is automatically saved
- **Smooth Animations**: Ball movement with arc trajectories
- **Sound Effects**: Audio feedback for actions
- **Victory Effects**: Particle celebrations on level completion

### Controls
- **Mouse/Touch**: Click tubes to select and move balls
- **Keyboard Shortcuts**:
  - `Esc`: Pause game
  - `R`: Restart level
  - `U`: Undo last move
  - `H`: Show hint

### Visual Features
- **Clean UI**: Modern design with Tailwind CSS
- **Smooth Animations**: Eased ball movements and effects
- **Responsive Design**: Works on desktop and mobile
- **Accessibility**: High contrast support, keyboard navigation
- **Particle Effects**: Victory celebrations and visual feedback

## ðŸš€ How to Run

1. **Simple Setup**: Open `index.html` in any modern web browser
2. **Local Server** (recommended): 
   ```bash
   # Using Python
   python -m http.server 8000
   
   # Using Node.js
   npx serve .
   
   # Using VS Code Live Server extension
   Right-click index.html -> "Open with Live Server"
   ```
3. **Access**: Open `http://localhost:8000` in your browser

## ðŸ“ File Structure

```
ball_sort_game/
â”œâ”€â”€ index.html          # Main game page with UI structure
â”œâ”€â”€ game.js            # Complete game logic and rendering
â”œâ”€â”€ styles.css         # Custom CSS animations and styles
â”œâ”€â”€ sw.js             # Service worker for offline play
â””â”€â”€ README.md         # This file
```

## ðŸŽ¯ Game Classes and Structure

### BallSortGame Class
The main game class containing:

- **Game State Management**: Level progression, moves, scoring
- **Tube System**: Ball storage and movement logic
- **Animation Engine**: Smooth ball movements and effects
- **UI Controls**: Button handling and modal management
- **Audio System**: Sound effects for actions
- **Save/Load**: Automatic progress persistence

### Key Methods
- `generateLevel()`: Creates puzzles with progressive difficulty
- `isValidMove()`: Validates ball movement rules
- `moveBall()`: Handles ball movement with animation
- `isLevelComplete()`: Checks win conditions
- `render()`: Canvas drawing and visual effects

## ðŸŽ¨ Customization Options

### Colors
Modify `ballColors` array in `game.js` to change ball colors:
```javascript
this.ballColors = [
    '#FF6B6B', '#4ECDC4', '#45B7D1', // Add more colors
];
```

### Difficulty
Adjust `getLevelConfig()` method to modify:
- Number of tubes per level
- Colors per level
- Balls per tube
- Empty tube ratios

### Animations
Modify easing functions and animation speeds:
```javascript
this.animatingBall.progress += 0.05; // Animation speed
```

### UI Themes
Update CSS variables in `styles.css` for different themes:
- Background gradients
- Button colors
- Tube appearances

## ðŸ”§ Technical Details

### Technologies Used
- **HTML5 Canvas**: Game rendering and graphics
- **JavaScript ES6+**: Game logic and interactions
- **Tailwind CSS**: UI styling and responsive design
- **Web APIs**: LocalStorage, Audio, Service Workers

### Performance Features
- **RequestAnimationFrame**: Smooth 60fps rendering
- **Efficient Rendering**: Only draws what's necessary
- **Memory Management**: Proper cleanup of effects and particles
- **Responsive Canvas**: Adapts to different screen sizes

### Browser Compatibility
- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+
- Mobile browsers with Canvas support

## ðŸŽµ Audio

The game includes embedded audio effects:
- **Pop Sound**: Ball movement feedback
- **Victory Sound**: Level completion celebration

Audio is embedded as base64 data URIs for offline functionality.

## ðŸ† Game Tips

1. **Plan Ahead**: Look for opportunities to create empty spaces
2. **Use Hints Wisely**: Save hints for truly challenging situations
3. **Stack Strategy**: Try to build complete color stacks early
4. **Undo Freely**: Don't hesitate to undo and try different approaches
5. **Pattern Recognition**: Look for repeating color patterns

## ðŸ› Known Limitations

- Audio may not work on some mobile browsers without user interaction
- Very large level numbers (50+) may generate extremely difficult puzzles
- Service worker caching may need manual refresh for updates

## ðŸ“± Mobile Support

The game is fully responsive and touch-friendly:
- Touch controls for ball selection and movement
- Responsive UI that adapts to screen size
- Optimized performance for mobile devices

## ðŸ”„ Future Enhancements

Potential additions:
- **Daily Challenges**: Special puzzle mode
- **Themes**: Unlockable visual themes
- **Leaderboards**: Competition and scoring
- **More Animations**: Enhanced visual effects
- **Tutorial Mode**: Interactive learning

## ðŸ“„ License

This project is open source and available under the MIT License.

---

**Enjoy playing Ball Sort Puzzle!** ðŸŽ‰

The game provides hours of engaging puzzle-solving fun with progressively challenging levels and smooth, polished gameplay.


styles.css

/* Custom CSS for Ball Sort Puzzle Game */

/* Welcome Screen Animations */
@keyframes float {
    0%, 100% {
        transform: translateY(0) rotate(0deg);
    }
    50% {
        transform: translateY(-20px) rotate(180deg);
    }
}

@keyframes fadeInScale {
    0% {
        opacity: 0;
        transform: scale(0.8) translateY(30px);
    }
    100% {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

/* Animation utility classes */
.animate-float {
    animation: float 6s ease-in-out infinite;
}

.animation-delay-300 {
    animation-delay: 300ms;
}

.animation-delay-500 {
    animation-delay: 500ms;
}

.animation-delay-600 {
    animation-delay: 600ms;
}

.animation-delay-900 {
    animation-delay: 900ms;
}

.animation-delay-1000 {
    animation-delay: 1000ms;
}

.animation-delay-1500 {
    animation-delay: 1500ms;
}

/* Welcome screen transitions */
#welcomeScreen {
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
}

#welcomeScreen.fade-out {
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none;
}

/* Game container initial state */
#gameContainer {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    display: none; /* Initially hidden */
}

#gameContainer.fade-in {
    opacity: 1;
    transform: translateY(0);
    display: block; /* Show when fading in */
}

/* Animation keyframes */
@keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0, 0, 0);
    }
    40%, 43% {
        transform: translate3d(0, -10px, 0);
    }
    70% {
        transform: translate3d(0, -5px, 0);
    }
    90% {
        transform: translate3d(0, -2px, 0);
    }
}

@keyframes shake {
    10%, 90% {
        transform: translate3d(-1px, 0, 0);
    }
    20%, 80% {
        transform: translate3d(2px, 0, 0);
    }
    30%, 50%, 70% {
        transform: translate3d(-4px, 0, 0);
    }
    40%, 60% {
        transform: translate3d(4px, 0, 0);
    }
}

@keyframes sparkle {
    0% {
        opacity: 0;
        transform: scale(0) rotate(0deg);
    }
    50% {
        opacity: 1;
        transform: scale(1) rotate(180deg);
    }
    100% {
        opacity: 0;
        transform: scale(1.2) rotate(360deg);
    }
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translate3d(0, 40px, 0);
    }
    to {
        opacity: 1;
        transform: translate3d(0, 0, 0);
    }
}

@keyframes timerWarning {
    0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
    }
    50% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
    }
}

/* Utility classes */
.bounce-animation {
    animation: bounce 0.6s ease-in-out;
}

.shake-animation {
    animation: shake 0.5s ease-in-out;
}

.sparkle-effect {
    position: absolute;
    width: 20px;
    height: 20px;
    background: radial-gradient(circle, #ffd700, #ffec8c);
    border-radius: 50%;
    animation: sparkle 1s ease-in-out;
    pointer-events: none;
}

.pulse-animation {
    animation: pulse 2s ease-in-out infinite;
}

.timer-warning {
    animation: timerWarning 1s ease-in-out infinite;
}

.fade-in-up {
    animation: fadeInUp 0.6s ease-out;
}

/* Custom button styles */
button:active {
    transform: scale(0.95);
}

button:disabled {
    cursor: not-allowed !important;
    opacity: 0.5 !important;
}

/* Canvas styling */
#gameCanvas {
    cursor: pointer;
    transition: all 0.3s ease;
}

#gameCanvas:hover {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

/* Modal animations */
.modal-enter {
    animation: fadeInUp 0.3s ease-out;
}

/* Progress bar */
.progress-bar {
    background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6, #f59e0b);
    background-size: 200% 100%;
    animation: shimmer 2s linear infinite;
}

@keyframes shimmer {
    0% {
        background-position: -200% 0;
    }
    100% {
        background-position: 200% 0;
    }
}

/* Responsive design */
@media (max-width: 768px) {
    #gameContainer {
        padding: 1rem;
    }
    
    #topBar {
        flex-direction: column;
        gap: 1rem;
    }
    
    #topBar > div {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    #bottomBar {
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    #bottomBar button {
        flex: 1;
        min-width: 120px;
    }
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}

/* Loading states */
.loading {
    position: relative;
    overflow: hidden;
}

.loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% {
        left: -100%;
    }
    100% {
        left: 100%;
    }
}

/* Focus styles for accessibility */
button:focus,
canvas:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    body {
        background: #000;
        color: #fff;
    }
    
    .bg-white\/20 {
        background: rgba(255, 255, 255, 0.9) !important;
        color: #000 !important;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Banner Ad Styles */
#bannerAdContainer {
    position: sticky;
    bottom: 0;
    z-index: 40;
    margin-bottom: 0;
}

#bannerAd {
    width: 100%;
    max-width: 320px;
    min-height: 50px;
}

#bannerAdPlaceholder {
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
    transition: all 0.3s ease;
}

#bannerAdPlaceholder:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

/* Mobile banner optimization */
@media screen and (max-width: 768px) {
    #bannerAdContainer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 8px;
        background: rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
    }
    
    #bannerAd {
        max-width: 100%;
        margin: 0 auto;
    }
    
    /* Adjust game container to account for banner */
    #gameContainer {
        padding-bottom: 80px;
    }
}

/* Pulse animation for ads */
@keyframes pulse-ad {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.8;
    }
}

.pulse-ad {
    animation: pulse-ad 2s infinite;
}


sw.js

/**
 * Service Worker for Ball Sort Puzzle Game
 * Provides offline functionality and caching
 */

const CACHE_NAME = 'ball-sort-puzzle-v1';
const urlsToCache = [
    '/',
    '/index.html',
    '/game.js',
    '/styles.css',
    'https://cdn.tailwindcss.com'
];

// Install event - cache resources
self.addEventListener('install', event => {
    event.waitUntil(
        caches.open(CACHE_NAME)
            .then(cache => {
                return cache.addAll(urlsToCache);
            })
    );
});

// Fetch event - serve from cache when offline
self.addEventListener('fetch', event => {
    event.respondWith(
        caches.match(event.request)
            .then(response => {
                // Return cached version or fetch from network
                return response || fetch(event.request);
            })
    );
});

// Activate event - clean up old caches
self.addEventListener('activate', event => {
    event.waitUntil(
        caches.keys().then(cacheNames => {
            return Promise.all(
                cacheNames.map(cacheName => {
                    if (cacheName !== CACHE_NAME) {
                        return caches.delete(cacheName);
                    }
                })
            );
        })
    );
});


testing-checklist.md

# Ball Sort Puzzle - Mobile Testing Checklist

## âœ… Functionality Tests
- [ ] Game loads correctly on Android device
- [ ] Touch controls work (tap to select/move balls)
- [ ] Timer counts down properly (60 seconds)
- [ ] Sound effects play on mobile
- [ ] AdMob ads show when time is up
- [ ] Rewarded ads give +30 seconds
- [ ] Game saves/loads progress correctly
- [ ] All buttons respond to touch
- [ ] Vibration feedback works (if implemented)

## âœ… Performance Tests
- [ ] Smooth 60fps gameplay
- [ ] No memory leaks during extended play
- [ ] Quick app startup time
- [ ] Responsive touch interactions
- [ ] Proper canvas scaling on different screen sizes

## âœ… Android-Specific Tests
- [ ] Back button pauses game
- [ ] App handles phone calls/notifications
- [ ] Proper behavior when app is minimized
- [ ] Orientation lock works (portrait only)
- [ ] Status bar and navigation bar handled correctly
- [ ] App doesn't crash on device rotation

## âœ… AdMob Integration Tests
- [ ] Test ads show correctly in development
- [ ] Real ads load in production build
- [ ] Reward mechanism works properly
- [ ] Ad failures handled gracefully
- [ ] No ads during active gameplay

## âœ… Device Compatibility
- [ ] Works on Android 6.0+ (API 23+)
- [ ] Tests on different screen sizes (phone/tablet)
- [ ] Various Android manufacturers (Samsung, Google, etc.)
- [ ] Different screen densities (hdpi, xhdpi, xxhdpi)

## âœ… Play Store Preparation
- [ ] App icon in all required sizes
- [ ] Screenshots for store listing
- [ ] App description and metadata
- [ ] Privacy policy (required for games with ads)
- [ ] Signed APK for release
- [ ] Version code and name set correctly


testing-guide.md

# ðŸš€ Complete Android Testing Guide for Ball Sort Puzzle

## Prerequisites Checklist

### âœ… Software Requirements
- [ ] Node.js (v14 or higher) - [Download](https://nodejs.org/)
- [ ] Java JDK 8 or 11 - [Download](https://www.oracle.com/java/technologies/downloads/)
- [ ] Android Studio - [Download](https://developer.android.com/studio)
- [ ] Apache Cordova - Install via: `npm install -g cordova`

### âœ… Environment Variables
- [ ] JAVA_HOME set to JDK installation
- [ ] ANDROID_HOME set to Android SDK location
- [ ] PATH includes Android SDK tools

### âœ… Android Studio Setup
- [ ] Android SDK installed
- [ ] Android SDK Build-Tools installed
- [ ] Android SDK Platform-Tools installed
- [ ] At least one Android Virtual Device (AVD) created

## Quick Start Method

### Option 1: Automated Build Script
```bash
# Run the automated build script
cd C:\Users\mayank_aggarwal2\ball_sort_game
build-android.bat
```

### Option 2: Manual Build Process

#### Step 1: Create Cordova Project
```bash
cd C:\Users\mayank_aggarwal2\
cordova create BallSortPuzzleApp com.yourcompany.ballsortpuzzle "Ball Sort Puzzle"
cd BallSortPuzzleApp
```

#### Step 2: Add Platform
```bash
cordova platform add android
cordova platform list
```

#### Step 3: Install Plugins
```bash
# Essential plugins for your game
cordova plugin add cordova-plugin-admob-free --variable ADMOB_ANDROID_APP_ID="ca-app-pub-3940256099942544~3347511713"
cordova plugin add cordova-plugin-device
cordova plugin add cordova-plugin-network-information
cordova plugin add cordova-plugin-vibration
cordova plugin add cordova-plugin-statusbar
cordova plugin add cordova-plugin-splashscreen
cordova plugin add cordova-plugin-whitelist

# Verify plugins
cordova plugin list
```

#### Step 4: Copy Files
```bash
cd www

# Remove default files
del index.html
rmdir /s /q css js img

# Copy your game files
copy "C:\Users\mayank_aggarwal2\ball_sort_game\index-mobile.html" index.html
copy "C:\Users\mayank_aggarwal2\ball_sort_game\game.js" .
copy "C:\Users\mayank_aggarwal2\ball_sort_game\user-progress.js" .
copy "C:\Users\mayank_aggarwal2\ball_sort_game\styles.css" .

cd ..

# Copy config
copy "C:\Users\mayank_aggarwal2\ball_sort_game\config.xml" .
```

#### Step 5: Build and Test
```bash
# Build the APK
cordova build android

# For device testing
cordova run android --device

# For emulator testing  
cordova emulate android
```

## Device Testing Setup

### Enable Developer Options on Android Device
1. Go to **Settings** â†’ **About Phone**
2. Tap **Build Number** 7 times
3. Go back to **Settings** â†’ **Developer Options**
4. Enable **USB Debugging**
5. Enable **Install via USB**

### Connect and Test
```bash
# Check if device is connected
adb devices

# Should show something like:
# List of devices attached
# ABC123DEF456    device

# Install and run on device
cordova run android --device
```

## Emulator Testing Setup

### Create Android Virtual Device (AVD)
1. Open **Android Studio**
2. Go to **Tools** â†’ **AVD Manager**
3. Click **Create Virtual Device**
4. Choose a device (e.g., Pixel 4)
5. Select system image (API 30 or higher recommended)
6. Click **Finish**

### Run on Emulator
```bash
# Start emulator from command line (optional)
emulator -avd Pixel_4_API_30

# Or use Cordova to start emulator and install
cordova emulate android
```

## Testing Checklist

### âœ… Basic Functionality
- [ ] App launches without crashes
- [ ] Welcome screen appears with animations
- [ ] "Start Game" button works
- [ ] Game canvas renders properly
- [ ] Ball sorting mechanics work
- [ ] Touch/tap interactions responsive
- [ ] Sound effects play (if enabled)
- [ ] Timer countdown works
- [ ] Level completion detection works

### âœ… Mobile-Specific Features
- [ ] App responds to device rotation (if enabled)
- [ ] Back button behavior (Android)
- [ ] App survives phone calls/interruptions
- [ ] Performance smooth on target devices
- [ ] Battery usage reasonable
- [ ] Memory usage within limits

### âœ… AdMob Integration
- [ ] Banner ads load (test ads should appear)
- [ ] Rewarded ads trigger correctly
- [ ] Ad clicks don't crash app
- [ ] Game continues after ad completion

### âœ… User Progress
- [ ] Game state saves correctly
- [ ] Progress persists after app restart
- [ ] Level progression works
- [ ] Statistics tracking accurate

## Common Issues and Solutions

### Issue 1: "Cordova is not recognized"
**Solution:**
```bash
npm install -g cordova
# Or use full path
C:\Users\[username]\AppData\Roaming\npm\cordova.cmd --version
```

### Issue 2: "ANDROID_HOME not set"
**Solution:**
1. Find Android SDK location (usually `C:\Users\[username]\AppData\Local\Android\Sdk`)
2. Add to Environment Variables:
   - Variable: `ANDROID_HOME`
   - Value: `C:\Users\[username]\AppData\Local\Android\Sdk`
3. Add to PATH: `%ANDROID_HOME%\platform-tools` and `%ANDROID_HOME%\tools`

### Issue 3: "Gradle build failed"
**Solution:**
```bash
# Update Gradle wrapper
cd platforms/android
./gradlew wrapper --gradle-version 7.4

# Or edit gradle-wrapper.properties
# Set: distributionUrl=https\://services.gradle.org/distributions/gradle-7.4-all.zip
```

### Issue 4: "Device not found"
**Solution:**
1. Install device drivers
2. Enable USB Debugging on device
3. Check with: `adb devices`
4. If device shows as "unauthorized", check device screen for authorization prompt

### Issue 5: "AdMob ads not showing"
**Expected:** Test ads should show during development
**Solution:**
- Verify plugin installation: `cordova plugin list`
- Check network connectivity
- Ensure correct test IDs are used
- Real ads only show in production/signed APKs

## Performance Optimization

### For Better Performance:
1. **Optimize images** - Compress any image assets
2. **Minimize DOM manipulation** - Your game uses canvas, which is good
3. **Enable hardware acceleration** in config.xml
4. **Test on lower-end devices** for compatibility

### Memory Management:
- Monitor memory usage in Chrome DevTools
- Test for memory leaks during long gameplay sessions
- Ensure proper cleanup of event listeners

## Release Build Process

### For Play Store Submission:
```bash
# Build release APK
cordova build android --release

# Generate keystore (one-time setup)
keytool -genkey -v -keystore ball-sort-puzzle.keystore -alias ball-sort-puzzle -keyalg RSA -keysize 2048 -validity 10000

# Sign APK
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore ball-sort-puzzle.keystore platforms/android/app/build/outputs/apk/release/app-release-unsigned.apk ball-sort-puzzle

# Align APK
zipalign -v 4 platforms/android/app/build/outputs/apk/release/app-release-unsigned.apk BallSortPuzzle.apk
```

## Next Steps After Testing

1. **Replace test AdMob IDs** with your real AdMob account IDs
2. **Create app icons** and splash screens
3. **Test on multiple devices** and Android versions
4. **Optimize performance** based on testing results
5. **Prepare Play Store listing** (description, screenshots, etc.)
6. **Submit to Google Play Store**

## Support and Troubleshooting

If you encounter issues:
1. Check Cordova documentation: https://cordova.apache.org/docs/
2. Android Developer documentation: https://developer.android.com/
3. Check device logs: `adb logcat`
4. Verify your environment setup with: `cordova requirements android`

Good luck with your Ball Sort Puzzle Android app! ðŸŽ¯ðŸš€


user-progress.js

/**
 * User Progress Management System
 * Handles persistent storage of user game progress with multiple storage options
 */

class UserProgressManager {
    constructor() {
        this.userId = null;
        this.userData = {
            maxLevelReached: 1,
            totalGamesPlayed: 0,
            totalMoves: 0,
            totalTimeSpent: 0,
            achievements: [],
            settings: {
                soundEnabled: true,
                vibrationEnabled: true
            },
            stats: {
                fastestCompletionTime: null,
                averageMovesPerLevel: 0,
                perfectLevels: 0, // Levels completed with minimum moves
                adsWatched: 0,
                coinsEarned: 0
            },
            lastPlayedDate: null,
            gameVersion: '1.0.0'
        };
        
        this.storageOptions = {
            localStorage: true,
            firebase: false,
            gameCenter: false,
            googlePlay: false
        };
        
        this.initialize();
    }

    /**
     * Initialize user progress system
     */
    async initialize() {
        // Generate or retrieve user ID
        this.userId = this.getUserId();
        
        // Try to load from various sources
        await this.loadUserProgress();
        
        // Setup auto-save
        this.setupAutoSave();
        
        console.log('User Progress Manager initialized for user:', this.userId);
    }

    /**
     * Generate or retrieve persistent user ID
     */
    getUserId() {
        let userId = localStorage.getItem('ballSortUserId');
        
        if (!userId) {
            // Generate unique user ID
            userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('ballSortUserId', userId);
            console.log('Generated new user ID:', userId);
        }
        
        return userId;
    }

    /**
     * Load user progress from available storage options
     */
    async loadUserProgress() {
        let loadedData = null;

        // Try loading from different sources in priority order
        
        // 1. Try Firebase (cloud storage)
        if (this.storageOptions.firebase) {
            try {
                loadedData = await this.loadFromFirebase();
                if (loadedData) {
                    console.log('Loaded progress from Firebase');
                }
            } catch (error) {
                console.warn('Failed to load from Firebase:', error);
            }
        }

        // 2. Try Game Center (iOS) or Google Play Games (Android)
        if (!loadedData && (this.storageOptions.gameCenter || this.storageOptions.googlePlay)) {
            try {
                loadedData = await this.loadFromGameServices();
                if (loadedData) {
                    console.log('Loaded progress from Game Services');
                }
            } catch (error) {
                console.warn('Failed to load from Game Services:', error);
            }
        }

        // 3. Fallback to localStorage
        if (!loadedData && this.storageOptions.localStorage) {
            loadedData = this.loadFromLocalStorage();
            if (loadedData) {
                console.log('Loaded progress from localStorage');
            }
        }

        // Merge loaded data with defaults
        if (loadedData) {
            this.userData = this.mergeUserData(this.userData, loadedData);
        }

        return this.userData;
    }

    /**
     * Save user progress to all available storage options
     */
    async saveUserProgress() {
        this.userData.lastPlayedDate = new Date().toISOString();
        
        const savePromises = [];

        // Save to localStorage (always available)
        if (this.storageOptions.localStorage) {
            try {
                this.saveToLocalStorage();
                console.log('Saved to localStorage');
            } catch (error) {
                console.error('Failed to save to localStorage:', error);
            }
        }

        // Save to Firebase
        if (this.storageOptions.firebase) {
            savePromises.push(
                this.saveToFirebase().catch(error => {
                    console.error('Failed to save to Firebase:', error);
                })
            );
        }

        // Save to Game Services
        if (this.storageOptions.gameCenter || this.storageOptions.googlePlay) {
            savePromises.push(
                this.saveToGameServices().catch(error => {
                    console.error('Failed to save to Game Services:', error);
                })
            );
        }

        // Wait for all saves to complete
        if (savePromises.length > 0) {
            await Promise.allSettled(savePromises);
        }

        console.log('User progress saved:', this.userData);
    }

    /**
     * Update max level reached
     */
    updateMaxLevel(level) {
        if (level > this.userData.maxLevelReached) {
            this.userData.maxLevelReached = level;
            this.saveUserProgress(); // Auto-save
            console.log(`New max level reached: ${level}`);
            
            // Trigger achievement check
            this.checkAchievements();
        }
    }

    /**
     * Update game statistics
     */
    updateStats(statsUpdate) {
        Object.assign(this.userData.stats, statsUpdate);
        this.saveUserProgress();
    }

    /**
     * Add game completion data
     */
    addGameCompletion(level, moves, timeSpent, perfectLevel = false) {
        this.userData.totalGamesPlayed++;
        this.userData.totalMoves += moves;
        this.userData.totalTimeSpent += timeSpent;
        
        if (perfectLevel) {
            this.userData.stats.perfectLevels++;
        }
        
        // Update fastest completion time
        if (!this.userData.stats.fastestCompletionTime || timeSpent < this.userData.stats.fastestCompletionTime) {
            this.userData.stats.fastestCompletionTime = timeSpent;
        }
        
        // Update average moves per level
        this.userData.stats.averageMovesPerLevel = this.userData.totalMoves / this.userData.totalGamesPlayed;
        
        this.updateMaxLevel(level);
    }

    /**
     * Record ad watched
     */
    recordAdWatched() {
        this.userData.stats.adsWatched++;
        this.userData.stats.coinsEarned += 10; // Give coins for watching ads
        this.saveUserProgress();
    }

    /**
     * Check and unlock achievements
     */
    checkAchievements() {
        const achievements = [];
        
        // Level-based achievements
        if (this.userData.maxLevelReached >= 5 && !this.hasAchievement('LEVEL_5')) {
            achievements.push({ id: 'LEVEL_5', name: 'Getting Started', description: 'Reach level 5' });
        }
        if (this.userData.maxLevelReached >= 10 && !this.hasAchievement('LEVEL_10')) {
            achievements.push({ id: 'LEVEL_10', name: 'Making Progress', description: 'Reach level 10' });
        }
        if (this.userData.maxLevelReached >= 25 && !this.hasAchievement('LEVEL_25')) {
            achievements.push({ id: 'LEVEL_25', name: 'Expert Player', description: 'Reach level 25' });
        }
        if (this.userData.maxLevelReached >= 50 && !this.hasAchievement('LEVEL_50')) {
            achievements.push({ id: 'LEVEL_50', name: 'Master Sorter', description: 'Complete all levels' });
        }

        // Stats-based achievements
        if (this.userData.stats.perfectLevels >= 5 && !this.hasAchievement('PERFECT_5')) {
            achievements.push({ id: 'PERFECT_5', name: 'Perfectionist', description: 'Complete 5 levels perfectly' });
        }
        if (this.userData.totalGamesPlayed >= 100 && !this.hasAchievement('GAMES_100')) {
            achievements.push({ id: 'GAMES_100', name: 'Dedicated Player', description: 'Play 100 games' });
        }

        // Add new achievements
        achievements.forEach(achievement => {
            this.userData.achievements.push({
                ...achievement,
                unlockedDate: new Date().toISOString()
            });
        });

        if (achievements.length > 0) {
            this.saveUserProgress();
            return achievements; // Return for UI notification
        }

        return [];
    }

    /**
     * Check if user has specific achievement
     */
    hasAchievement(achievementId) {
        return this.userData.achievements.some(a => a.id === achievementId);
    }

    /**
     * Get user progress data
     */
    getUserData() {
        return { ...this.userData };
    }

    /**
     * Reset user progress (for testing or user request)
     */
    resetProgress() {
        const userId = this.userId;
        this.userData = {
            maxLevelReached: 1,
            totalGamesPlayed: 0,
            totalMoves: 0,
            totalTimeSpent: 0,
            achievements: [],
            settings: {
                soundEnabled: true,
                vibrationEnabled: true
            },
            stats: {
                fastestCompletionTime: null,
                averageMovesPerLevel: 0,
                perfectLevels: 0,
                adsWatched: 0,
                coinsEarned: 0
            },
            lastPlayedDate: null,
            gameVersion: '1.0.0'
        };
        this.userId = userId;
        this.saveUserProgress();
        console.log('User progress reset');
    }

    // Storage implementation methods

    /**
     * Save to localStorage
     */
    saveToLocalStorage() {
        const data = {
            userId: this.userId,
            userData: this.userData,
            savedAt: new Date().toISOString()
        };
        localStorage.setItem('ballSortUserProgress', JSON.stringify(data));
        localStorage.setItem('ballSortMaxLevel', this.userData.maxLevelReached.toString());
    }

    /**
     * Load from localStorage
     */
    loadFromLocalStorage() {
        try {
            const data = localStorage.getItem('ballSortUserProgress');
            if (data) {
                const parsed = JSON.parse(data);
                return parsed.userData;
            }
            
            // Legacy support - check for old max level storage
            const maxLevel = localStorage.getItem('ballSortMaxLevel');
            if (maxLevel) {
                return { maxLevelReached: parseInt(maxLevel) };
            }
        } catch (error) {
            console.error('Error loading from localStorage:', error);
        }
        return null;
    }

    /**
     * Save to Firebase (cloud storage)
     */
    async saveToFirebase() {
        // Implement Firebase integration
        if (typeof firebase !== 'undefined' && firebase.firestore) {
            const db = firebase.firestore();
            await db.collection('userProgress').doc(this.userId).set({
                ...this.userData,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        } else {
            throw new Error('Firebase not available');
        }
    }

    /**
     * Load from Firebase
     */
    async loadFromFirebase() {
        if (typeof firebase !== 'undefined' && firebase.firestore) {
            const db = firebase.firestore();
            const doc = await db.collection('userProgress').doc(this.userId).get();
            if (doc.exists) {
                return doc.data();
            }
        }
        return null;
    }

    /**
     * Save to Game Services (Game Center/Google Play)
     */
    async saveToGameServices() {
        // For Cordova/PhoneGap apps
        if (typeof window.plugins !== 'undefined') {
            if (window.plugins.gameCenter) {
                // iOS Game Center
                await this.saveToGameCenter();
            } else if (window.plugins.googlePlayGames) {
                // Android Google Play Games
                await this.saveToGooglePlay();
            }
        } else {
            throw new Error('Game Services not available');
        }
    }

    /**
     * Load from Game Services
     */
    async loadFromGameServices() {
        if (typeof window.plugins !== 'undefined') {
            if (window.plugins.gameCenter) {
                return await this.loadFromGameCenter();
            } else if (window.plugins.googlePlayGames) {
                return await this.loadFromGooglePlay();
            }
        }
        return null;
    }

    /**
     * iOS Game Center integration
     */
    async saveToGameCenter() {
        // Implementation for Game Center cloud save
        // This would use the Game Center API to save user progress
        console.log('Saving to Game Center...');
    }

    async loadFromGameCenter() {
        // Implementation for Game Center cloud load
        console.log('Loading from Game Center...');
        return null;
    }

    /**
     * Google Play Games integration
     */
    async saveToGooglePlay() {
        // Implementation for Google Play Games cloud save
        console.log('Saving to Google Play Games...');
    }

    async loadFromGooglePlay() {
        console.log('Loading from Google Play Games...');
        return null;
    }

    /**
     * Merge user data with defaults
     */
    mergeUserData(defaultData, loadedData) {
        return {
            ...defaultData,
            ...loadedData,
            settings: { ...defaultData.settings, ...(loadedData.settings || {}) },
            stats: { ...defaultData.stats, ...(loadedData.stats || {}) },
            achievements: loadedData.achievements || defaultData.achievements
        };
    }

    /**
     * Setup automatic saving
     */
    setupAutoSave() {
        // Save every 30 seconds during active play
        setInterval(() => {
            this.saveUserProgress();
        }, 30000);

        // Save when page is about to unload
        window.addEventListener('beforeunload', () => {
            this.saveUserProgress();
        });

        // Save when app goes to background (mobile)
        document.addEventListener('pause', () => {
            this.saveUserProgress();
        });
    }
}

// Export for use in main game
window.UserProgressManager = UserProgressManager;
